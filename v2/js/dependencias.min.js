var Box=function(t){t=t||{};var e=t.content||{},n=t.padding||{},a=t.margin||{},r={},i={},o={};if(Number.isInteger(e)){var l=e;e={},e.width=l,e.height=l}else e.width=e.width||0,e.height=e.height||0;if(Number.isInteger(n)){var l=n;n={},n.top=l,n.right=l,n.bottom=l,n.left=l}else n.top=n.top||0,n.right=n.right||0,n.bottom=n.bottom||0,n.left=n.left||0;if(Number.isInteger(a)){var l=a;a={},a.top=l,a.right=l,a.bottom=l,a.left=l}else a.top=a.top||0,a.right=a.right||0,a.bottom=a.bottom||0,a.left=a.left||0;return r.width=e.width+n.left+n.right,r.height=e.height+n.top+n.bottom,i.width=r.width+a.left+a.right,i.height=r.height+a.top+a.bottom,o.margin=a,o.padding=n,o.content=e,o.inner=r,o.outter=i,o},Frame=function(t){t=t||{},_.defaults(t||{},{width:1e3,height:600,top:20,right:20,bottom:20,left:20});var e={top:t.top,right:t.right,bottom:t.bottom,left:t.left},n={width:t.width+e.left+e.right,height:t.height+e.top+e.bottom},a={width:t.width,height:t.height};return{getMain:function(){return a},getMargin:function(){return e},getFrame:function(){return n}}},clonsola=function(){function t(t){console.log(_.cloneDeep(t))}function e(t){console.dir(_.cloneDeep(t))}function n(t){console.warn(_.cloneDeep(t))}function a(t){console.error(_.cloneDeep(t))}function r(t){console.table(_.cloneDeep(t))}function i(){console.clear()}return{log:t,dir:e,warn:n,error:a,table:r,clear:i}}(),funciones=function(){function t(t,e){e=e||null;var n=t.split("-");return"fin"===e?new Date(n[2],n[0]-1,n[1],23,59,59,999):new Date(n[2],n[0]-1,n[1])}function e(t){var e=0;return e=Math.pow(10,Math.ceil(Math.log10(t))),t<.25*e?e*=.25:t<.5*e&&(e*=.5),e}return{getFecha:t,getNumeroBonito:e}}(),promiseSerial=function(t){return t.reduce(function(t,e){return t.then(function(t){return e().then(Array.prototype.concat.bind(t))})},Promise.resolve([]))},tooltips=function(){function t(){return r}function e(){r.trigger="click"}function n(t){t.each(function(t){r.content=$(t.tooltip.contenido),r.theme="tooltipster-shadow",$(this).tooltipster(r)})}function a(t){t.each(function(t){$(this).tooltipster("content",$(t.tooltip.contenido))})}var r={trigger:"custom",delay:0,delayTouch:0,animationDuration:100,triggerOpen:{mouseenter:!0,touchstart:!0},triggerClose:{mouseleave:!0,tap:!0},contentAsHTML:!0,theme:"tooltipster-shadow"};return{getOpciones:t,debug:e,generaTooltips:n,actualizaTooltips:a}}(),url=function(){function t(t){for(n=0;n<r.length;n++)if(e=r[n].split("="),e[0]===t)return void 0===e[1]||decodeURIComponent(e[1])}var e,n,a=window.location.search.substring(1),r=a.split("&");return{getParameter:t}}(),GrafoConPeso=function(t,e){function n(t){var e=[],n=null,r={};_.each(t,function(t){e=[],e.push(t.source),e.push(t.target),e=e.sort(a),n=e.join("_"),r.hasOwnProperty(n)?r[n].value+=t.value:r[n]={source:t.source,target:t.target,value:t.value}}),t=_.values(r),t=_.orderBy(t,["peso","origen","destino"],["desc","asc","asc"]),r={},_.each(t,function(t){r.hasOwnProperty(t.source)?r[t.source].n=r[t.source].n+1:r[t.source]={id:t.source,name:t.source,tooltip:{color:"#69b3a2",contenido:"<p>"+t.source+"</p>"},n:1},r.hasOwnProperty(t.target)?r[t.target].n=r[t.target].n+1:r[t.target]={id:t.target,name:t.target,tooltip:{color:"#69b3a2",contenido:"<p>"+t.target+"</p>"},n:1}}),k=_.values(r),A=t}function a(t,e){var n=t.toUpperCase(),a=e.toUpperCase();return n<a?-1:n>a?1:0}function r(){var t=Math.sqrt(k.length/(f.width*f.height));z=d3.forceSimulation(k).force("link",d3.forceLink(A).id(function(t){return t.id})).force("charge",d3.forceManyBody().strength(-1.5/t)).force("gravity",d3.forceManyBody().strength(10*t)).force("x",d3.forceX()).force("y",d3.forceY()).force("center",d3.forceCenter(f.width/2,f.height/2)).force("collision",d3.forceCollide().radius(function(t){return b(5*t.n)}))}function i(){w=v.selectAll("line").data(A).enter().append("line").attr("stroke","#eee").attr("stroke-width",1),y=m.selectAll("g").data(k).enter().append("g").attr("class","blend grab").on("dblclick",function(t){t.fx=null,t.fy=null,d3.select(this).select("circle").attr("stroke","#eee").attr("stroke-width","1px")}).call(o(z)),y.append("circle").attr("r",function(t){return b(t.n)}).attr("fill",function(t){return x(t.n/10)}).attr("stroke","#eee").attr("stroke-width","1px"),y.append("text").text(function(t){return t.name}).attr("text-anchor","middle").attr("dominant-baseline","middle").attr("y",function(t){return b(t.n)+t.n+5}).attr("font-size",function(t){return t.n+10}).attr("fill","#808080"),z.on("tick",function(){w.attr("x1",function(t){return t.source.x}).attr("y1",function(t){return t.source.y}).attr("x2",function(t){return t.target.x}).attr("y2",function(t){return t.target.y}),y.attr("transform",function(t){return"translate("+t.x+","+t.y+")"})})}function o(t){function e(e){d3.select(this).attr("class","blend grabbing"),d3.select(this).select("circle").attr("stroke","#ccc").attr("stroke-width","2px"),d3.event.active||t.alphaTarget(.3).restart(),e.fx=e.x,e.fy=e.y}function n(t){t.fx=d3.event.x,t.fy=d3.event.y}function a(e){d3.select(this).attr("class","blend grab"),d3.event.active||t.alphaTarget(0),e.fx=d3.event.x,e.fy=d3.event.y}return d3.drag().on("start",e).on("drag",n).on("end",a)}function l(){t.removeClass("espera")}var s=!1,c=new Frame({width:800,height:800}),u=c.getFrame(),d=c.getMargin(),f=c.getMain(),p=null,g=null,h=null,v=null,m=null,b=d3.scaleSqrt().domain([0,10]).range([0,20]),x=d3.interpolateRainbow,y=[],w=[],k=[],A=[],z=null;!function(){if(p=d3.select(t[0]),!1===(t.data("visualizacion")||!1)){t.data("visualizacion",!0),p.selectAll("svg").remove(),g=p.append("svg").attr("preserveAspectRatio","xMidYMid").attr("viewBox",[0,0,u.width,u.height]),t.attr("data-setup",!0),!0===s&&g.attr("id",t.data("tipo-visualizacion")+"-"+e).append("rect").attr("fill","yellow").attr("opacity",.5).attr("x",0).attr("y",0).attr("width",u.width).attr("height",u.height),g=g.append("g").attr("transform","translate("+d.left+","+d.top+")"),!0===s&&g.attr("class","svg").append("rect").attr("width",f.width).attr("height",f.height).attr("fill","blue").attr("opacity",.5),h=g.append("g"),v=h.append("g"),m=h.append("g").attr("class","isolate"),!0===s&&(h.attr("id","gGrafo-"+e),v.attr("id","gEnlaces-"+e),m.attr("id","gNodos-"+e));var a="csv/grafos/"+t.data("duplas")+".csv",o=[a],c=[];_.each(o,function(t){c.push(d3.csv(t,function(t,e){return{source:t.source,target:t.target,value:+t.weight}}))}),Promise.all(c).then(function(t){n(t[0]),r(),i(),l()})}}()},MapaDeFlujos=function(t,e){function n(t){var e=d3.schemeCategory10,n={},a=0,r={};return _.each(t,function(t,i){var o=+t.pais;n.hasOwnProperty(o)||(n[o]=d3.hsl(e[a%e.length]),a++),r[t.slug]={slug:t.slug,lugar:t.lugar,coordenadas:z([t.longitud,t.latitud]),coordenadasR:[t.longitud,t.latitud],pais:o,nombrepais:t.nombrepais,color:n[o]}}),r}function a(t){var e={},n=null,a=null,r=null,i=null,o=null,l=null;_.each(t,function(t){a=t.clave,n=e[a]||!1,r=A[t.origen.slug],i=A[t.destino.slug],!1===n&&(e[a]={clave:t.clave,activo:t.activo,destino:{coordenadas:i.coordenadas,nombre:i.lugar,slug:i.slug,pais:i.pais,nombrepais:i.nombrepais,color:i.color,activo:!0},estilo:{color:t.estilo.color},origen:{coordenadas:r.coordenadas,nombre:r.lugar,slug:r.slug,pais:r.pais,nombrepais:r.nombrepais,color:r.color,activo:!0},tooltip:{color:t.estilo.color,contenido:null},noticias:[],puntos:[]},o=M({type:"LineString",coordinates:[r.coordenadasR,i.coordenadasR]}),l=o.split("M"),l=l[1].split("L"),l=_.map(l,function(t){return t.split(",")}),e[a].puntos=l),e[a].noticias.push({destino:{fecha:t.destino.fecha},origen:{fecha:t.origen.fecha},dias:(t.destino.fecha-t.origen.fecha)/864e5,enlace:t.enlace,estilo:{color:t.estilo.color},fuente:t.fuente,id:t.id,noticia:t.noticia,periodico:t.periodico,tooltip:{color:t.estilo.color,contenido:null}})});return _.values(e)}function r(){var t=_.map(k,function(t){return t.noticias.length}),e=funciones.getNumeroBonito(_.max(t));P.domain([1,e])}function i(){b.attr("fill","#c6e6ec").append("rect").attr("width",g.content.width).attr("height",g.content.height),x.attr("fill","#efefef").attr("stroke","#ababab").attr("stroke-width",1);var t=topojson.feature(w,w.objects.countries).features,e={};_.each(A,function(t,n){e[t.pais]=t.color}),x.selectAll("path").data(t).enter().insert("path").attr("d",M).attr("fill",function(t){return t.color=e.hasOwnProperty(t.id)?e[t.id]:null,t.color}).attr("class",function(t){return t.activo=!!e.hasOwnProperty(t.id),e.hasOwnProperty(t.id)?"activo":null}),x.selectAll("path.activo").on("click",u)}function o(){var t=m.append("defs").selectAll("linearGradient").data(k).enter().append("linearGradient").attr("gradientUnits","userSpaceOnUse").attr("id",function(t){return"gradiente-"+t.origen.slug+"-"+t.destino.slug}).attr("x1",function(t){return t.origen.coordenadas[0]}).attr("y1",function(t,e){return t.origen.coordenadas[1]}).attr("x2",function(t,e){return t.destino.coordenadas[0]}).attr("y2",function(t,e){return t.destino.coordenadas[1]});t.append("stop").attr("offset","0%").attr("stop-color",function(t){return t.origen.color}),t.append("stop").attr("offset","100%").attr("stop-color",function(t){return t.destino.color})}function l(){var t=y.style("mix-blend-mode","multiply").selectAll("g.flujo").data(k).enter().insert("g").attr("class","flujo");t.append("path").attr("class","invisible").attr("d",function(t){return D(t.puntos)}).attr("shape-rendering","geometricPrecision").attr("stroke","#ffffff").style("stroke-width","20px").style("stroke-style","solid").attr("opacity",0).attr("fill","none").on("click",d).each(function(t){var e=tooltips.getOpciones(),n="",a=[],r=0,i=0,o=0,l=0,s={year:"numeric",month:"long",day:"numeric"};n+='<h2><span style="color:'+t.origen.color+';">'+t.origen.nombre+", "+t.origen.nombrepais+'</span> - <span style="color:'+t.destino.color+';">'+t.destino.nombre+", "+t.destino.nombrepais+"</span></h2>",n+="<p>Se encontraron <strong>"+t.noticias.length+" noticias</strong> en este flujo</p>",a=_.map(t.noticias,function(t){return t.origen.fecha}),r=_.min(a),o=_.max(a),a=_.map(t.noticias,function(t){return t.destino.fecha}),i=_.min(a),l=_.max(a),n+="<p>La primera noticia se envió el <strong>"+r.toLocaleDateString("sp",s)+"</strong> y se recibió el <strong>"+i.toLocaleDateString("sp",s)+"</strong></p>",n+="<p>La última noticia se envió el <strong>"+o.toLocaleDateString("sp",s)+"</strong> y se recibió el <strong>"+l.toLocaleDateString("sp",s)+"</strong></p>",a=_.map(t.noticias,"dias"),a=Math.round(_.mean(a)),n+="<p>En promedio, las noticias tardaron <strong>"+a+" días</strong> en llegar a su destino</p>",t.contenido=n,e.content=$(n),$(this).tooltipster(e)}),t.append("path").attr("class","flujo visible").attr("d",function(t){return D(t.puntos)}).attr("shape-rendering","geometricPrecision").style("stroke-width",0).style("stroke-style","solid").style("stroke-linecap","round").style("stroke",function(t){return t.origen.color}).attr("opacity",.8).attr("fill","none").each(function(t){t.largo=d3.select(this).node().getTotalLength()}).attr("stroke-dasharray",function(t){return t.largo+" "+t.largo}).attr("stroke-dashoffset",function(t){return t.largo}).transition().duration(1500).ease(d3.easeLinear).attr("stroke-dashoffset",0).style("stroke-width",function(t){return P(t.noticias.length)+"px"})}function s(){t.removeClass("espera")}function c(){x.style("stroke-width",1/d3.event.transform.k+"px"),y.selectAll("path.invisible").style("stroke-width",20/d3.event.transform.k+"px"),y.selectAll("path.visible").style("stroke-width",function(t){return P(t.noticias.length)/d3.event.transform.k+"px"}),x.attr("transform",d3.event.transform),y.attr("transform",d3.event.transform),y.selectAll("path.invisible").each(function(t){$(this).tooltipster("content",$(t.contenido))})}function u(t){var e=d3.select(this),n=null,a=null,r=null,i=[],o=[];t.activo=!t.activo,e.transition().duration(400).attr("fill",function(t){return t.activo?t.color:f(t.color)}),n=_.filter(k,function(e){return e.origen.pais===t.id||e.destino.pais===t.id}),_.each(n,function(e){i.push(e.clave),e.origen.pais===t.id&&(e.origen.activo=t.activo),e.destino.pais===t.id&&(e.destino.activo=t.activo)}),y.selectAll("path.visible").filter(function(t){return i.indexOf(t.clave)>=0}).transition().duration(400).attr("opacity",function(t){return t.activo&&t.origen.activo&&t.destino.activo?.8:.2}),a=_.filter(n,function(t){return t.activo}),_.each(a,function(t){t.origen.activo&&o.push(t.origen.pais),t.destino.activo&&o.push(t.destino.pais)}),o=_.uniq(o);var r=_.filter(k,function(t){return t.activo&&t.destino.activo&&t.origen.activo&&(o.indexOf(t.origen.pais)>=0||o.indexOf(t.destino.pais)>=0)});x.selectAll("path.activo").filter(function(t){return t.activo&&o.indexOf(t.id)>=0}).transition().duration(400).attr("fill",function(t){var e=_.filter(r,function(e){return e.destino.pais==t.id}),n=_.filter(r,function(e){return e.origen.pais==t.id});return t.activo&&(e.length>0||n.length>0)?t.color:f(t.color)})}function d(t){var e=d3.select(this.parentNode),n=e.select("path.flujo.visible"),a=null;t.activo=!t.activo,n.transition().duration(400).attr("opacity",function(t){return t.activo?.8:.2}),a=_.filter(k,function(e){return e.activo&&(e.origen.pais===t.origen.pais||e.destino.pais===t.origen.pais||e.origen.pais===t.destino.pais||e.destino.pais===t.destino.pais)}),x.selectAll("path.activo").filter(function(e){return e.id===t.origen.pais||e.id===t.destino.pais}).transition().duration(400).attr("fill",function(t){var e=_.filter(a,function(e){return e.destino.pais===t.id}),n=_.filter(a,function(e){return e.origen.pais===t.id});return!1===t.activo&&(e.length>0||n.length>0)&&(t.activo=!0),t.activo&&(e.length>0||n.length>0)?t.color:f(t.color)})}function f(t){return d3.hsl(t.h,t.s-.3,.8)}var p=!1,g=Box({content:{width:1e3,height:600}}),h=null,v=null,m=null,b=null,x=null,y=null,w=null,k=null,A=null,z=d3.geoMercator().scale(400).translate([850,500]),M=d3.geoPath().projection(z),D=d3.line().x(function(t){return t[0]}).y(function(t){return t[1]}).curve(d3.curveBasis),P=d3.scaleLog().range([1,5]),L=[1,3],j=d3.zoom().scaleExtent(L).on("zoom",c);!function(){if(h=d3.select(t[0]),!1===(t.data("visualizacion")||!1)){t.data("visualizacion",!0),h.selectAll("svg").remove(),v=h.append("svg").attr("preserveAspectRatio","xMidYMid").attr("viewBox","0 0 "+g.inner.width+" "+g.inner.height).call(j),t.attr("data-setup",!0),!0===p&&v.attr("id",t.data("tipo-visualizacion")+"-"+e).append("rect").attr("fill","yellow").attr("opacity",.5).attr("x",0).attr("y",0).attr("width",g.inner.width).attr("height",g.inner.height),v=v.append("g").attr("transform","translate("+g.padding.left+","+g.padding.top+")"),!0===p&&v.attr("class","svg").append("rect").attr("width",g.content.width).attr("height",g.content.height).attr("fill","blue").attr("opacity",.5),m=v.append("g"),b=v.append("g"),x=v.append("g"),y=v.append("g"),!0===p&&(m.attr("id","gDefs-"+e),b.attr("id","gMar-"+e),x.attr("id","gPaises-"+e),y.attr("id","gFlujos-"+e));var c="csv/"+t.data("lugares")+".csv",u="csv/"+t.data("flujos")+".csv",d=[];d.push(d3.json("json/mundo.json")),d.push(d3.csv(c)),d.push(d3.csv(u,function(t,e){return{id:+t.id_noticia,activo:!0,periodico:t.periodico,noticia:t.noticia,fuente:t.fuente,enlace:t.enlace,origen:{fecha:funciones.getFecha(t.fecha_origen),slug:t.origen},destino:{fecha:funciones.getFecha(t.fecha_destino),slug:t.destino},clave:t.origen+"_"+t.destino,estilo:{color:"#000000",tamanio:0},tooltip:{color:"#000000",contenido:null}}})),Promise.all(d).then(function(t){w=t[0],A=n(t[1]),k=a(t[2]),r(),i(),o(),l(),s()})}}()},MapaDeNoticias=function(t,e){function n(t){var e=d3.interpolateRainbow,n=d3.scaleLinear(),a=null,r=0,i={},o=_.map(t,function(t){return+t.pais});return o=_.uniq(o),n.domain([0,o.length]),_.each(t,function(t){t.pais=+t.pais,r=_.indexOf(o,t.pais),a=e((n(r)+.9)%o.length),i[t.slug]={slug:t.slug,lugar:t.lugar,coordenadas:vt([t.longitud,t.latitud]),coordenadasR:[t.longitud,t.latitud],pais:t.pais,nombrepais:t.nombrepais,color:d3.hsl(a)}}),i}function a(t){var e=_.values(t);return e=_.map(e,function(t){return{color:t.color,nombrepais:t.nombrepais,pais:t.pais,activo:!0}}),e=_.uniqBy(e,"pais")}function r(t){var e={},n=null,a=null;return _.each(t,function(t){a=t.origen.fecha.getTime()+"-"+t.destino.fecha.getTime(),n=e[a]||!1,!1===n&&(e[a]={clave:a,activo:!0,noticias:[],dias:[(t.origen.fecha-st[0])/864e5,(t.destino.fecha-st[0])/864e5],origen:t.origen.fecha,destino:t.destino.fecha,destinoPadding:t.destino.fechaPadding}),e[a].noticias.push(t)}),_.values(e)}function i(t){gt=_.map(t,function(t){return(t.origen.fecha-st[0])/864e5}),gt=_.uniq(gt),ht=_.map(t,function(t){return(t.destino.fecha-st[0])/864e5}),ht=_.uniq(ht)}function o(t){var e={},n=null,a=null,r=null,i=null,o=null,l=null;_.each(t,function(t){a=t.clave,n=e[a]||!1,r=rt[t.origen.slug],i=rt[t.destino.slug],!1===n&&(e[a]={clave:t.clave,activo:t.activo,destino:{coordenadas:i.coordenadas,nombre:i.lugar,slug:i.slug,pais:i.pais,nombrepais:i.nombrepais,color:i.color,activo:!0},estilo:{color:t.estilo.color},origen:{coordenadas:r.coordenadas,nombre:r.lugar,slug:r.slug,pais:r.pais,nombrepais:r.nombrepais,color:r.color,activo:!0},tooltip:{color:t.estilo.color,contenido:null},noticias:[],puntos:[]},o=mt({type:"LineString",coordinates:[r.coordenadasR,i.coordenadasR]}),l=o.split("M"),l=l[1].split("L"),l=_.map(l,function(t){return t.split(",")}),e[a].puntos=l),e[a].noticias.push({destino:{fecha:t.destino.fecha},origen:{fecha:t.origen.fecha},dias:(t.destino.fecha-t.origen.fecha)/864e5,enlace:t.enlace,estilo:{color:t.estilo.color},fuente:t.fuente,id:t.id,noticia:t.noticia,periodico:t.periodico,tooltip:{color:t.estilo.color,contenido:null}})});return _.values(e)}function l(t){return _.each(t,function(t){t.origen.pais=rt[t.origen.slug].pais,t.destino.pais=rt[t.destino.slug].pais,t.color=rt[t.origen.slug].color,t.dias=[(t.origen.fecha-st[0])/864e5,(t.destino.fecha-st[0])/864e5]}),t}function s(t){var e=[],n=_.map(t,function(t){return t.origen.fecha});e.push(_.min(n));var a=_.map(t,function(t){return t.destino.fecha});return e.push(_.max(a)),e}function c(){var t=_.map(at,function(t){return t.noticias.length}),e=funciones.getNumeroBonito(_.max(t));xt.domain([1,e])}function u(){q.attr("fill","#c6e6ec").append("rect").attr("width",T.content.width).attr("height",T.content.height),I.attr("fill","#efefef").attr("stroke","#ababab").attr("stroke-width",1);var t=topojson.feature(nt,nt.objects.countries).features,e={};_.each(rt,function(t,n){e[t.pais]=t.color}),I.selectAll("path").data(t).enter().insert("path").attr("d",mt).attr("fill",function(t){return t.color=e.hasOwnProperty(t.id)?e[t.id]:null,t.color}).attr("class",function(t){return t.activo=!!e.hasOwnProperty(t.id),e.hasOwnProperty(t.id)?"activo":null}),I.selectAll("path.activo").filter(function(t){return t.id!==C}).on("click",w)}function d(){ot=_.filter(it,function(t){return t.pais!==C}),ot=_.sortBy(ot,"nombrepais"),_.each(ot,function(t){t.noticiasOrigen=[],t.noticiasDestino=[],t.noticias=_.filter(et,function(e){return e.origen.pais==t.pais})})}function f(){X.attr("fill","#ababab").attr("stroke-width",1),X.append("text").attr("x",0).attr("y",0).attr("dominant-baseline","hanging").text("Países").attr("font-size",30);var t=X.append("g").attr("transform","translate(11,60)"),e=t.selectAll("g").data(ot).enter().insert("g").attr("transform",function(t,e){return"translate(0,"+30*e+")"}).on("click",function(t){});e.append("circle").attr("r",11).attr("fill",function(t){return t.color}),e.append("text").text(function(t){return t.nombrepais}).attr("x",15).attr("y",1).attr("dominant-baseline","middle")}function p(){var t=(st[1]-st[0])/864e5;ct.domain([0,t])}function g(){var t=F.inner.width/2-75+100,e=F.inner.width/2+75+100;J.attr("fill","#ababab").attr("stroke-width",1),J.append("text").attr("x",t).attr("y",11).attr("text-anchor","middle").attr("dominant-baseline","hanging").text("Envío").attr("font-size",20),J.append("text").attr("x",e).attr("y",11).attr("text-anchor","middle").attr("dominant-baseline","hanging").text("Recepción").attr("font-size",20),Y.attr("stroke","#efefef").attr("stroke-width",1),Y.append("line").attr("stroke","#ababab").attr("x1",t).attr("y1",0).attr("x2",t).attr("y2",lt),Y.append("line").attr("stroke","#ababab").attr("x1",e).attr("y1",0).attr("x2",e).attr("y2",lt);var n=_.min(gt),a=_.max(ht),r=_.range(n,a+1);Y.selectAll("line.envio").data(r).enter().insert("line").attr("class","envio").attr("x1",t-10).attr("y1",function(t){return ct(t)}).attr("x2",t).attr("y2",function(t){return ct(t)}),Y.selectAll("line.recepcion").data(r).enter().insert("line").attr("class","recepcion").attr("x1",e).attr("y1",function(t){return ct(t)}).attr("x2",e+10).attr("y2",function(t){return ct(t)}),Y.selectAll("text.envio").data(r).enter().insert("text").attr("class","envio").attr("font-size",11).attr("text-anchor","end").attr("stroke","#ababab").attr("stroke-width",0).attr("fill","#ababab").attr("x",t-15).attr("y",function(t){return ct(t)+2}).text(function(t){var e=new Date(st[0]);return e.setDate(e.getDate()+t),e.toLocaleDateString()}),Y.selectAll("text.recepcion").data(r).enter().insert("text").attr("class","recepcion").attr("font-size",11).attr("text-anchor","start").attr("stroke","#ababab").attr("stroke-width",0).attr("fill","#ababab").attr("x",e+15).attr("y",function(t){return ct(t)+2}).text(function(t){var e=new Date(st[0]);return e.setDate(e.getDate()+t),e.toLocaleDateString()})}function h(){var t=F.inner.width/2-75+100,e=F.inner.width/2+75+100;H.attr("stroke","#efefef"),console.log(pt[10]);var n=H.selectAll("g").data(pt).enter().insert("g");n.insert("path").attr("class","guia").attr("d",function(n){return"M"+t+","+ct(n.dias[0])+"L"+e+","+ct(n.dias[1])}).attr("stroke","transparent"),n.insert("path").attr("class","periodo").attr("d",function(n){return"M"+t+","+ct(n.dias[0])+"L"+e+","+ct(n.dias[1])}),n.insert("circle").attr("class","destino").attr("fill","#ababab").attr("r",4).attr("cx",t).attr("cy",function(t){return ct(t.dias[0])})}function v(){E.selectAll("g.flujo").data(at).enter().insert("g").attr("class","flujo").append("path").attr("class","flujo visible").attr("d",function(t){return bt(t.puntos)}).attr("shape-rendering","geometricPrecision").style("stroke-width",0).style("stroke-style","solid").style("stroke-linecap","round").style("stroke",function(t){return t.origen.color}).attr("fill","none").style("stroke-width",1)}function m(){var t=R.content.width-100,e=0,n=0;e=t/ot.length,n=50+e/2;var a=dt(0);_.each(ot,function(t){t.noticiasOrigen=_.filter(t.noticias,function(t){return t.origen.fecha<=a}),t.noticiasDestino=_.filter(t.noticias,function(t){return t.destino.fecha<=a})}),K.selectAll("path.enviadas").data(ot).enter().insert("path").attr("class","enviada").attr("fill",function(t){return k(t.color)}).attr("d",function(t){return Q.size(ut(t.noticiasOrigen.length))()}).attr("transform",function(t,a){return"translate("+(n+a*e)+",160)"}),K.selectAll("path.recibida").data(ot).enter().insert("path").attr("class","recibida").attr("fill",function(t){return t.color}).attr("d",function(t){return Q.size(ut(t.noticiasDestino.length))()}).attr("transform",function(t,a){return"translate("+(n+a*e)+",160)"}),K.selectAll("text.nombre").data(ot).enter().insert("text").attr("class","nombre").attr("font-size",20).attr("fill","#ababab").attr("stroke-width",1).attr("text-anchor","middle").attr("x",function(t,a){return n+a*e}).attr("y",290).text(function(t){return t.nombrepais}),K.selectAll("text.noticiase").data(ot).enter().insert("text").attr("class","noticiase").attr("font-size",14).attr("fill","#ababab").attr("stroke-width",1).attr("text-anchor","middle").attr("x",function(t,a){return n+a*e}).attr("y",310).text(function(t){return t.noticiasOrigen.length+" enviadas"}),K.selectAll("text.noticiasr").data(ot).enter().insert("text").attr("class","noticiasr").attr("font-size",14).attr("fill","#ababab").attr("stroke-width",1).attr("text-anchor","middle").attr("x",function(t,a){return n+a*e}).attr("y",328).text(function(t){return t.noticiasDestino.length+" recibidas"}),K.append("text").text("Noticias por país").attr("fill","#ababab").attr("stroke-width",1).attr("text-anchor","middle").attr("dominant-baseline","hanging").attr("x",800).attr("y",0).attr("font-size",30)}function b(){var t=_.map(et,function(t){return t.origen.fecha}),e=_.map(et,function(t){return t.destino.fecha}),n=_.clone(_.min(t)),a=_.clone(_.max(e));n=new Date(n.setTime(n.getTime()-864e5)),a=new Date(a.setTime(a.getTime()+1728e5-1)),dt.domain([0,530]).range([n,a]),W=V.append("text").text("Fecha: "+n.toLocaleDateString()).attr("x",0).attr("y",0).attr("fill","#ababab").attr("font-size",20).attr("stroke-width",1).attr("dominant-baseline","hanging"),V.append("rect").attr("fill","#efefef").attr("height",50).attr("width",580).attr("x",0).attr("y",30),Z=V.append("rect").attr("fill","#ababab").attr("height",50).attr("width",50).attr("x",0).attr("y",30).call(_t)}function x(){t.removeClass("espera"),tt=d3.timer(L)}function y(){I.style("stroke-width",1/d3.event.transform.k+"px"),E.selectAll("path.visible").style("stroke-width",function(t){return 1/d3.event.transform.k+"px"}),I.attr("transform",d3.event.transform),E.attr("transform",d3.event.transform)}function w(t){var e=d3.select(this);t.activo=!t.activo,e.transition().duration(200).attr("fill",function(t){return t.activo?t.color:k(t.color)})}function k(t){return d3.hsl(t.h,t.s-.3,.9)}function A(t){d3.select(this).attr("stroke","black")}function z(t){var e=d3.select(this),n=+e.attr("x"),a=Math.round(n+d3.event.dx);a<0&&(a=0),a>530&&(a=530),e.attr("x",a),O(a)}function M(t){d3.select(this).attr("stroke",null)}function D(t){W.text("Fecha: "+t.toLocaleDateString())}function P(t){_.each(ot,function(e){e.noticiasOrigen=_.filter(e.noticias,function(e){return e.origen.fecha<=t}),e.noticiasDestino=_.filter(e.noticias,function(e){return e.destino.fecha<=t})}),K.selectAll("path.enviada").transition().duration(50).attr("d",function(t){return Q.size(ut(t.noticiasOrigen.length))()}),K.selectAll("path.recibida").transition().duration(50).attr("d",function(t){return Q.size(ut(t.noticiasDestino.length))()}),K.selectAll("text.noticiase").text(function(t){return t.noticiasOrigen.length+" enviadas"}),K.selectAll("text.noticiasr").text(function(t){return t.noticiasDestino.length+" recibidas"})}function L(){var t=+Z.attr("x")+2;t>=530&&(t=530),Z.attr("x",t),O(t),530==t&&tt.stop()}function j(t){var e=dt(t);H.selectAll("g").each(function(t,n){var a=d3.select(this),r=a.select("path.guia"),i=a.select("circle.destino"),o=null,l=r.node().getTotalLength();if(e<=t.origen&&(o=r.node().getPointAtLength(0)),t.destinoPadding<=e)o=r.node().getPointAtLength(l);else var s=t.destinoPadding.getTime()-t.origen.getTime(),c=e.getTime()-t.origen.getTime(),u=100*c/s,o=r.node().getPointAtLength(u*l/100);i.attr("cx",o.x).attr("cy",o.y)})}function O(t){var e=dt(t);D(e),P(e),j(t)}var B=!1,C=484,R=Box({content:{width:1600,height:960},padding:20}),T=Box({content:{width:1e3,height:600}}),F=Box({content:{width:580,height:500},margin:{top:0,right:20,bottom:0,left:0}}),S=(Box({content:{width:1600,height:340}}),null),N=null,$=null,q=null,I=null,E=null,G=null,U=null,Y=null,H=null,X=null,J=null,K=null,Q=d3.symbol().type(d3.symbolDiamond),V=null,W=null,Z=null,tt=null,et=null,nt=null,at=null,rt=null,it=null,ot=null,lt=450,st=null,ct=d3.scaleLinear().range([10,lt-10]),ut=d3.scaleLinear().domain([0,300]).range([0,15e3]),dt=(d3.scaleLinear().domain([0,530]).range([0,100]),d3.scaleLinear()),ft=null,pt=null,gt=null,ht=null,vt=d3.geoMercator().scale(400).translate([885,570]),mt=d3.geoPath().projection(vt),bt=d3.line().x(function(t){return t[0]}).y(function(t){return t[1]}).curve(d3.curveBasis),xt=d3.scaleLog().range([1,5]),yt=[1,3],wt=d3.zoom().scaleExtent(yt).on("zoom",y),_t=d3.drag().on("start",A).on("drag",z).on("end",M);!function(){if(S=d3.select(t[0]),!1===(t.data("visualizacion")||!1)){t.data("visualizacion",!0),S.selectAll("svg").remove(),N=S.append("svg").attr("preserveAspectRatio","xMidYMid").attr("viewBox","0 0 "+R.inner.width+" "+R.inner.height),t.attr("data-setup",!0),!0===B&&N.attr("id",t.data("tipo-visualizacion")+"-"+e).append("rect").attr("fill","yellow").attr("opacity",.5).attr("x",0).attr("y",0).attr("width",R.inner.width).attr("height",R.inner.height);var y=N.append("g").attr("transform","translate("+(R.padding.left+F.outter.width)+","+R.padding.top+")");$=y.append("svg").attr("width",T.inner.width).attr("height",T.inner.height).call(wt),!0===B&&$.attr("id","svgMapa-"+e),$=$.append("g").attr("transform","translate("+T.padding.left+","+T.padding.top+")"),!0===B&&$.attr("class","svg").append("rect").attr("width",T.content.width).attr("height",T.content.height).attr("fill","blue").attr("opacity",.5),q=$.append("g"),I=$.append("g"),E=$.append("g"),!0===B&&(q.attr("id","gMar-"+e),I.attr("id","gPaises-"+e),E.attr("id","gFlujos-"+e)),G=N.append("g").attr("transform","translate("+R.padding.left+","+R.padding.top+")"),!0===B&&(G.attr("id","svgGrafica-"+e),G.attr("class","svg").append("rect").attr("width",F.inner.width).attr("height",F.inner.height).attr("fill","red").attr("opacity",.5)),U=G.append("g"),Y=U.append("g").attr("transform","translate(0,40)"),H=U.append("g").attr("transform","translate(0,40)").attr("class","isolate"),X=G.append("g"),J=G.append("g"),!0===B&&(U.attr("id","gEjes-"+e),X.attr("id","gControles-"+e),J.attr("id","gLeyendas-"+e),H.attr("id","gNoticias-"+e),Y.attr("id","gLineas-"+e)),K=N.append("g").attr("transform","translate("+R.padding.left+",640)"),!0===B&&(K.attr("id","svgResumen-"+e),K.append("rect").attr("fill","green").attr("width",1600).attr("height",340)),V=N.append("g").attr("transform","translate("+R.padding.left+",540)"),!0===B&&(V.attr("id","svgSlider-"+e),V.append("rect").attr("fill","purple").attr("width",580).attr("height",80));var w="csv/"+t.data("lugares")+".csv",_="csv/"+t.data("noticias")+".csv",k=[];k.push(d3.json("json/mundo.json")),k.push(d3.csv(w)),k.push(d3.csv(_,function(t,e){return{id:+t.id_noticia,activo:!0,periodico:t.periodico,noticia:t.noticia,fuente:t.fuente,enlace:t.enlace,origen:{fecha:funciones.getFecha(t.fecha_origen),slug:t.origen},destino:{fechaPadding:funciones.getFecha(t.fecha_destino,"fin"),fecha:funciones.getFecha(t.fecha_destino),slug:t.destino},clave:t.origen+"_"+t.destino,estilo:{color:"#000000",tamanio:0},tooltip:{color:"#000000",contenido:null}}})),Promise.all(k).then(function(t){nt=t[0],rt=n(t[1]),it=a(rt),st=s(t[2]),ft=l(t[2]),at=o(t[2]),pt=r(t[2]),i(t[2]),et=t[2],c(),u(),d(),f(),p(),g(),h(),v(),b(),m(),x()})}}()},NubeDePalabrasCombinadas=function(t,e){function n(){!0===l&&v.append("rect").attr("width",f.width).attr("height",s).attr("fill","red").attr("opacity",.5),v.append("text").style("font-family","Roboto").attr("text-anchor","start").style("fill","#808080").style("font-size","24px").attr("dy","1.5em").text("Categorías:");var t=v.append("g").attr("transform","translate(200,0)"),e=t.selectAll("g").data(b).enter().append("g").on("click",function(t){t.flagMostrar=!t.flagMostrar,d3.select(this).select("text").text(function(t){var e="☑";return!1===t.flagMostrar&&(e="☐"),t.etiqueta+" "+e}),r()});e.append("text").attr("class","pointer").style("font-family","Roboto").attr("text-anchor","start").style("fill","#808080").style("font-size","24px").attr("dy","1.5em").text(function(t){return t.etiqueta+" ☑"}).each(function(t){t.caja=this.getBBox()});var n=_.map(b,function(t){return t.caja.width});n.unshift(0),e.attr("transform",function(t,e){var a=n.slice(0,e+1);return"translate("+(_.sum(a)+e*A)+",0)"})}function a(){m=d3.layout.cloud().size([f.width,f.height]).text(function(t){return t.palabra}).rotate(function(){return 45*(~~(5*Math.random())-2)}).fontSize(function(t){return t.estilo.tamanio}).spiral("rectangular").font("Roboto").on("end",i)}function r(){var t=null,e=null,n=0,a=0,r={};e=_.filter(b,"flagMostrar"),_.each(e,function(t){r[t.categoria]=t.singular}),a=e.length,a>0&&(n=Math.ceil(x/a)),t=_.map(e,function(t){return _.clone(t.palabras).splice(0,n)}),t=_.flatten(t);var i=d3.scaleSymlog().range([6,50]).domain([w,k]);window.escala=i,
_.each(t,function(t){t.estilo.tamanio=+i(t.valor)}),m.stop().words(t).start()}function i(t){var n=d3.transition("nubedepalabras-"+e).duration(200).ease(d3.easeCubicIn),a=h.selectAll("text").data(t,function(t){return t.palabra.toLowerCase()});a.transition(n).attr("transform",function(t){return"translate("+[t.x+f.width/2,t.y+f.height/2]+")rotate("+t.rotate+")"}).style("font-size",function(t){return t.estilo.tamanio+"px"}),a.enter().append("text").style("font-family","Roboto").attr("text-anchor","middle").style("fill",function(t){return t.estilo.color}).text(function(t){return t.palabra}).attr("transform",function(t){return"translate("+[t.x+f.width/2,t.y+f.height/2]+")rotate(0)"}).style("font-size","0px").transition(n).attr("transform",function(t){return"translate("+[t.x+f.width/2,t.y+f.height/2]+")rotate("+t.rotate+")"}).style("font-size",function(t){return t.estilo.tamanio+"px"}),a.exit().transition(n).style("font-size","0px").remove()}function o(){t.removeClass("espera"),r()}var l=!1,s=40,c=new Frame,u=c.getFrame(),d=c.getMargin(),f=c.getMain(),p=null,g=null,h=null,v=null,m=null,b=null,x=180,y=0,w=0,k=0,A=100;!function(){if(p=d3.select(t[0]),!1===(t.data("visualizacion")||!1)){t.data("visualizacion",!0),p.selectAll("svg").remove(),g=p.append("svg").attr("preserveAspectRatio","xMidYMid").attr("viewBox","0 0 "+u.width+" "+(u.height+s)),t.attr("data-setup",!0),!0===l&&g.attr("id",t.data("tipo-visualizacion")+"-"+e).append("rect").attr("fill","yellow").attr("opacity",.5).attr("x",0).attr("y",0).attr("width",u.width).attr("height",u.height+s),g=g.append("g").attr("transform","translate("+d.left+","+d.top+")"),!0===l&&g.attr("class","svg").append("rect").attr("width",f.width).attr("height",f.height+s).attr("fill","blue").attr("opacity",.5),h=g.append("g"),v=g.append("g").attr("transform","translate(0,"+f.height+")"),!0===l&&(h.attr("id","gPalabras-"+e),v.attr("id","gControles-"+e));var r="csv/"+t.data("palabras")+".csv",i="csv/"+t.data("categorias")+".csv",c=[],m=d3.interpolateRainbow;c.push(d3.csv(r,function(t,e){var n=m(e/10+.5);return{palabra:t.palabra.replace(/_/g," "),categoria:t.categoria,valor:+t.valor,estilo:{color:n,tamanio:0},tooltip:{color:n,contenido:null}}})),c.push(d3.csv(i)),Promise.all(c).then(function(t){var e=t[0],r=t[1],i=null,l=[];y=r.length,b=[],_.each(r,function(t){var n=t.etiqueta,a=t.singular,r=t.categoria;i=_.filter(e,{categoria:r}),i=_.orderBy(i,["valor","palabra"],["desc","desc"]),i=i.splice(0,x),l.push(_.minBy(i,"valor")),l.push(_.maxBy(i,"valor")),b.push({etiqueta:n,singular:a,categoria:r,flagMostrar:!0,palabras:i})}),l=_.map(l,"valor"),w=_.min(l),k=_.max(l),n(),a(),o()})}}()},NubeDePalabras=function(t,e){function n(){var t=d3.min(p,function(t){return t.valor}),e=d3.max(p,function(t){return t.valor}),n=d3.scaleLinear().range([20,120]).domain([t,e]);_.each(p,function(t){var e=1===t.valor?"repetición":"repeticiones";t.estilo.tamanio=+n(t.valor),t.tooltip.contenido='<p><em style="color:'+t.estilo.color+' ">'+t.palabra+":</em> "+t.valor+" "+e+"</p>"}),d3.layout.cloud().size([c.width,c.height]).words(p).text(function(t){return t.palabra}).rotate(function(){return 30*(~~(5*Math.random())-2)}).fontSize(function(t){return t.estilo.tamanio}).spiral("rectangular").font("Roboto").on("end",a).start()}function a(t){var n=d3.transition("nubedepalabras-"+e).duration(400).ease(d3.easeCubicIn);f.selectAll("text").data(t).enter().append("text").style("font-family","Roboto").attr("text-anchor","middle").style("fill",function(t){return t.estilo.color}).attr("transform",function(t){return"translate("+[t.x+c.width/2,t.y+c.height/2]+")rotate(0)"}).text(function(t){return t.palabra}).style("font-size","0px").transition(n).attr("transform",function(t){return"translate("+[t.x+c.width/2,t.y+c.height/2]+")rotate("+t.rotate+")"}).style("font-size",function(t){return t.estilo.tamanio+"px"}),r()}function r(){tooltips.generaTooltips(f.selectAll("text")),t.removeClass("espera")}var i=!1,o=new Frame,l=o.getFrame(),s=o.getMargin(),c=o.getMain(),u=null,d=null,f=null,p=null;!function(){if(u=d3.select(t[0]),!1===(t.data("visualizacion")||!1)){t.data("visualizacion",!0),u.selectAll("svg").remove(),d=u.append("svg").attr("preserveAspectRatio","xMidYMid").attr("viewBox","0 0 "+l.width+" "+l.height),t.attr("data-setup",!0),!0===i&&d.attr("id",t.data("tipo-visualizacion")+"-"+e).append("rect").attr("fill","yellow").attr("opacity",.5).attr("x",0).attr("y",0).attr("width",l.width).attr("height",l.height),d=d.append("g").attr("transform","translate("+s.left+","+s.top+")"),!0===i&&d.attr("class","svg").append("rect").attr("width",c.width).attr("height",c.height).attr("fill","blue").attr("opacity",.5),f=d.append("g"),!0===i&&f.attr("id","gPalabras-"+e);var a="csv/"+t.data("palabras")+".csv",r=[a],o=[],g=d3.schemeCategory10;_.each(r,function(t){o.push(d3.csv(t,function(t,e){return{palabra:t.palabra.replace(/_/g," "),valor:+t.valor,estilo:{color:g[e%g.length],tamanio:0},tooltip:{color:g[e%g.length],contenido:null}}}))}),Promise.all(o).then(function(t){p=t[0],p=_.orderBy(p,["valor","palabra"],["desc","desc"]),p=p.splice(0,150),n()})}}()};$(function(){function t(t,e,n){switch(n){case"nube-de-palabras":new NubeDePalabras(t,e);break;case"nube-de-palabras-combinadas":new NubeDePalabrasCombinadas(t,e);break;case"mapa-de-flujos":new MapaDeFlujos(t,e);break;case"grafo-con-peso":new GrafoConPeso(t,e);break;case"mapa-de-noticias":new MapaDeNoticias(t,e)}}var e=[];!function(){e=$(".contenedor-visualizacion"),e.addClass("espera"),_.each(e,function(e,n){e=$(e),t(e,n,e.data("tipo-visualizacion"))})}()});var Box=function(t){t=t||{};var e=t.content||{},n=t.padding||{},a=t.margin||{},r={},i={},o={};if(Number.isInteger(e)){var l=e;e={},e.width=l,e.height=l}else e.width=e.width||0,e.height=e.height||0;if(Number.isInteger(n)){var l=n;n={},n.top=l,n.right=l,n.bottom=l,n.left=l}else n.top=n.top||0,n.right=n.right||0,n.bottom=n.bottom||0,n.left=n.left||0;if(Number.isInteger(a)){var l=a;a={},a.top=l,a.right=l,a.bottom=l,a.left=l}else a.top=a.top||0,a.right=a.right||0,a.bottom=a.bottom||0,a.left=a.left||0;return r.width=e.width+n.left+n.right,r.height=e.height+n.top+n.bottom,i.width=r.width+a.left+a.right,i.height=r.height+a.top+a.bottom,o.margin=a,o.padding=n,o.content=e,o.inner=r,o.outer=i,o},clonsola=function(){function t(t){console.log(_.cloneDeep(t))}function e(t){console.dir(_.cloneDeep(t))}function n(t){console.warn(_.cloneDeep(t))}function a(t){console.error(_.cloneDeep(t))}function r(t){console.table(_.cloneDeep(t))}function i(){console.clear()}return{log:t,dir:e,warn:n,error:a,table:r,clear:i}}(),promiseSerial=function(t){return t.reduce(function(t,e){return t.then(function(t){return e().then(Array.prototype.concat.bind(t))})},Promise.resolve([]))},tooltips=function(){function t(){return r}function e(){r.trigger="click"}function n(t){t.each(function(t){r.content=$(t.tooltip.contenido),r.theme="tooltipster-shadow",$(this).tooltipster(r)})}function a(t){t.each(function(t){$(this).tooltipster("content",$(t.tooltip.contenido))})}var r={trigger:"custom",delay:0,delayTouch:0,animationDuration:100,triggerOpen:{mouseenter:!0,touchstart:!0},triggerClose:{mouseleave:!0,tap:!0},contentAsHTML:!0,theme:"tooltipster-shadow"};return{getOpciones:t,debug:e,generaTooltips:n,actualizaTooltips:a}}(),keys=keys||function(t){var e=[];for(var n in t)e.push(n);return e},slug=function(t){var e="àáäâèéëêìíïîòóöôùúüûñç",n={"@":" at ","€":" euro ",$:" dollar ","¥":" yen ","&":" and ","æ":"ae","œ":"oe"};return t.toLowerCase().replace(new RegExp("["+e+"]","g"),function(t){return"aaaaeeeeiiiioooouuuunc".charAt(e.indexOf(t))}).replace(new RegExp("["+keys(n).join("")+"]","g"),function(t){return n[t]}).replace(/[^a-z0-9]/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"")},url=function(){function t(t){for(n=0;n<r.length;n++)if(e=r[n].split("="),e[0]===t)return void 0===e[1]||decodeURIComponent(e[1])}var e,n,a=window.location.search.substring(1),r=a.split("&");return{getParameter:t}}();
//# sourceMappingURL=dependencias.min.js.map
