{"version":3,"sources":["aplicacion.js","box/box.js","clonsola/clonsola.js","promiseserial/promiseserial.js","tooltips/tooltips.js","slug/slugs.js","url/url.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC1nGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACnEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AClCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACpDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC/CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACrDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"dependencias.min.js","sourcesContent":["/*\r\nFunciona como el modelo de cajas con box-sizing: border-box\r\nO sea, el ancho y alto INCLUYEN el padding\r\nhttps://developer.mozilla.org/en-US/docs/Learn/CSS/Introduction_to_CSS/Box_model#Advanced_box_manipulation\r\n*/\r\n\r\n//TODO: Reemplazar Frame en la nube de palabras\r\n\r\nvar Box = function (options) {\r\n  options = options || {};\r\n  var content = options.content || {};\r\n  var padding = options.padding || {};\r\n  var margin = options.margin || {};\r\n  var inner = {};\r\n  var outter = {};\r\n  var box = {};\r\n\r\n  if (Number.isInteger(content)) {\r\n    var valor = content;\r\n    content = {};\r\n    content.width = valor;\r\n    content.height = valor;\r\n  } else {\r\n    content.width = content.width || 0;\r\n    content.height = content.height || 0;\r\n  }\r\n\r\n  if (Number.isInteger(padding)) {\r\n    var valor = padding;\r\n    padding = {};\r\n    padding.top = valor;\r\n    padding.right = valor;\r\n    padding.bottom = valor;\r\n    padding.left = valor;\r\n  } else {\r\n    padding.top = padding.top || 0;\r\n    padding.right = padding.right || 0;\r\n    padding.bottom = padding.bottom || 0;\r\n    padding.left = padding.left || 0;\r\n  }\r\n\r\n  if (Number.isInteger(margin)) {\r\n    var valor = margin;\r\n    margin = {};\r\n    margin.top = valor;\r\n    margin.right = valor;\r\n    margin.bottom = valor;\r\n    margin.left = valor;\r\n  } else {\r\n    margin.top = margin.top || 0;\r\n    margin.right = margin.right || 0;\r\n    margin.bottom = margin.bottom || 0;\r\n    margin.left = margin.left || 0;\r\n  }\r\n\r\n  inner.width = content.width + padding.left + padding.right;\r\n  inner.height = content.height + padding.top + padding.bottom;\r\n\r\n  outter.width = inner.width + margin.left + margin.right;\r\n  outter.height = inner.height + margin.top + margin.bottom;\r\n\r\n  box.margin = margin;\r\n  box.padding = padding;\r\n  box.content = content;\r\n  box.inner = inner;\r\n  box.outter = outter;\r\n\r\n  return box;\r\n};\r\n\r\nvar Frame = function (options) {\r\n  options = options || {};\r\n  _.defaults(options || {}, {\r\n    width: 1000,\r\n    height: 600,\r\n    top: 20,\r\n    right: 20,\r\n    bottom: 20,\r\n    left: 20,\r\n  });\r\n\r\n  var margin = {\r\n    top: options.top,\r\n    right: options.right,\r\n    bottom: options.bottom,\r\n    left: options.left,\r\n  };\r\n\r\n  var frame = {\r\n    width: options.width + margin.left + margin.right,\r\n    height: options.height + margin.top + margin.bottom,\r\n  };\r\n\r\n  var main = {\r\n    width: options.width,\r\n    height: options.height,\r\n  };\r\n\r\n  return {\r\n    getMain: function () {\r\n      return main;\r\n    },\r\n    getMargin: function () {\r\n      return margin;\r\n    },\r\n    getFrame: function () {\r\n      return frame;\r\n    },\r\n  };\r\n};\r\n\r\nvar clonsola = (function () {\r\n  function log(obj) {\r\n    console.log(_.cloneDeep(obj));\r\n  }\r\n\r\n  function dir(obj) {\r\n    console.dir(_.cloneDeep(obj));\r\n  }\r\n\r\n  function warn(obj) {\r\n    console.warn(_.cloneDeep(obj));\r\n  }\r\n\r\n  function error(obj) {\r\n    console.error(_.cloneDeep(obj));\r\n  }\r\n\r\n  function table(obj) {\r\n    console.table(_.cloneDeep(obj));\r\n  }\r\n\r\n  function clear() {\r\n    console.clear();\r\n  }\r\n\r\n  return {\r\n    log: log,\r\n    dir: dir,\r\n    warn: warn,\r\n    error: error,\r\n    table: table,\r\n    clear: clear,\r\n  };\r\n})();\r\n\r\nvar funciones = (function () {\r\n  function _getFecha(cadena, modificador) {\r\n    modificador = modificador || null;\r\n    var arreglo = cadena.split(\"-\");\r\n    if (modificador === \"fin\")\r\n      return new Date(arreglo[2], arreglo[0] - 1, arreglo[1], 23, 59, 59, 999);\r\n    else return new Date(arreglo[2], arreglo[0] - 1, arreglo[1]);\r\n  }\r\n\r\n  function _getNumeroBonito(entero) {\r\n    var numero = 0;\r\n    numero = Math.pow(10, Math.ceil(Math.log10(entero)));\r\n    if (entero < 0.25 * numero) {\r\n      numero = 0.25 * numero;\r\n    } else if (entero < 0.5 * numero) {\r\n      numero = 0.5 * numero;\r\n    }\r\n    return numero;\r\n  }\r\n\r\n  return {\r\n    getFecha: _getFecha,\r\n    getNumeroBonito: _getNumeroBonito,\r\n  };\r\n})();\r\n\r\nvar promiseSerial = function promiseSerial(funcs) {\r\n  return funcs.reduce(function (promise, func) {\r\n    return promise.then(function (result) {\r\n      return func().then(Array.prototype.concat.bind(result));\r\n    });\r\n  }, Promise.resolve([]));\r\n};\r\n\r\n/*\r\n// some url's to resolve\r\nvar urls = ['/url1', '/url2', '/url3']\r\n\r\n// convert each url to a function that returns a promise\r\nvar funcs = urls.map(function (url) {\r\n  return function () {\r\n    return $.ajax(url);\r\n  };\r\n});\r\n\r\n// execute Promises in serial\r\npromiseSerial(funcs)\r\n  .then(console.log.bind(console))\r\n.catch(console.error.bind(console))\r\n*/\r\n\r\n/*\r\n\"use strict\";\r\n\r\nvar getChuckNorrisFact = function getChuckNorrisFact(url) {\r\n  return new Promise(function (resolve, reject) {\r\n    request.get(url, function (error, response, data) {\r\n      if (error) reject(error);\r\n\r\n      var content = JSON.parse(data);\r\n      var fact = content.value;\r\n      resolve(fact);\r\n    });\r\n  });\r\n};\r\n\r\ngetChuckNorrisFact(url).then(function (fact) {\r\n  return console.log(fact);\r\n} // actually outputs a string\r\n);\r\n*/\r\n\r\n/*\r\nhttps://hackernoon.com/functional-javascript-resolving-promises-sequentially-7aac18c4431e\r\nhttps://medium.freecodecamp.org/how-to-make-a-promise-out-of-a-callback-function-in-javascript-d8ec35d1f981\r\nhttps://decembersoft.com/posts/promises-in-serial-with-array-reduce/\r\nhttps://gist.github.com/anvk/5602ec398e4fdc521e2bf9940fd90f84\r\n*/\r\n\r\nvar tooltips = (function () {\r\n  var opciones = {\r\n    trigger: \"custom\",\r\n    delay: 0,\r\n    delayTouch: 0,\r\n    animationDuration: 100,\r\n    triggerOpen: {\r\n      mouseenter: true,\r\n      touchstart: true,\r\n    },\r\n    triggerClose: {\r\n      mouseleave: true,\r\n      tap: true,\r\n    },\r\n    contentAsHTML: true,\r\n    theme: \"tooltipster-shadow\",\r\n  };\r\n\r\n  function _getOpciones() {\r\n    return opciones;\r\n  }\r\n\r\n  function _debug() {\r\n    opciones.trigger = \"click\";\r\n  }\r\n\r\n  function generaTooltips(elementos) {\r\n    elementos.each(function (d) {\r\n      opciones.content = $(d.tooltip.contenido);\r\n      opciones.theme = \"tooltipster-shadow\";\r\n      $(this).tooltipster(opciones);\r\n    });\r\n  }\r\n\r\n  function actualizaTooltips(elementos) {\r\n    elementos.each(function (d) {\r\n      $(this).tooltipster(\"content\", $(d.tooltip.contenido));\r\n    });\r\n  }\r\n\r\n  return {\r\n    getOpciones: _getOpciones,\r\n    debug: _debug,\r\n    generaTooltips: generaTooltips,\r\n    actualizaTooltips: actualizaTooltips,\r\n  };\r\n})();\r\n\r\nvar url = (function () {\r\n  var _sPageURL = window.location.search.substring(1),\r\n    _sURLVariables = _sPageURL.split(\"&\"),\r\n    _sParameterName,\r\n    i;\r\n\r\n  function getParameter(sParam) {\r\n    for (i = 0; i < _sURLVariables.length; i++) {\r\n      _sParameterName = _sURLVariables[i].split(\"=\");\r\n\r\n      if (_sParameterName[0] === sParam) {\r\n        return _sParameterName[1] === undefined\r\n          ? true\r\n          : decodeURIComponent(_sParameterName[1]);\r\n      }\r\n    }\r\n  }\r\n\r\n  return {\r\n    getParameter: getParameter,\r\n  };\r\n})();\r\n\r\nvar GrafoConPeso = function (el, i) {\r\n  var debug = false;\r\n  var frame = new Frame({ width: 800, height: 800 });\r\n\r\n  var marco = frame.getFrame();\r\n  var margin = frame.getMargin();\r\n  var principal = frame.getMain();\r\n\r\n  var contenedor = null;\r\n  var svg = null;\r\n  var gGrafo = null;\r\n  var gEnlaces = null;\r\n  var gNodos = null;\r\n\r\n  var escalaRadio = d3.scaleSqrt().domain([0, 10]).range([0, 20]);\r\n\r\n  var escalaColor = d3.interpolateRainbow;\r\n\r\n  var nodos = [];\r\n  var enlaces = [];\r\n\r\n  var arregloNodos = [];\r\n  var arregloEnlaces = [];\r\n\r\n  var simulacion = null;\r\n\r\n  function setup() {\r\n    contenedor = d3.select(el[0]);\r\n    var flag = el.data(\"visualizacion\") || false;\r\n    if (flag === false) {\r\n      el.data(\"visualizacion\", true);\r\n      contenedor.selectAll(\"svg\").remove();\r\n      svg = contenedor\r\n        .append(\"svg\")\r\n        .attr(\"preserveAspectRatio\", \"xMidYMid\")\r\n        .attr(\"viewBox\", [0, 0, marco.width, marco.height]);\r\n\r\n      el.attr(\"data-setup\", true);\r\n\r\n      if (debug === true) {\r\n        svg\r\n          .attr(\"id\", el.data(\"tipo-visualizacion\") + \"-\" + i)\r\n          .append(\"rect\")\r\n          .attr(\"fill\", \"yellow\")\r\n          .attr(\"opacity\", 0.5)\r\n          .attr(\"x\", 0)\r\n          .attr(\"y\", 0)\r\n          .attr(\"width\", marco.width)\r\n          .attr(\"height\", marco.height);\r\n      }\r\n\r\n      svg = svg\r\n        .append(\"g\")\r\n        .attr(\"transform\", \"translate(\" + margin.left + \",\" + margin.top + \")\");\r\n\r\n      if (debug === true) {\r\n        svg\r\n          .attr(\"class\", \"svg\")\r\n          .append(\"rect\")\r\n          .attr(\"width\", principal.width)\r\n          .attr(\"height\", principal.height)\r\n          .attr(\"fill\", \"blue\")\r\n          .attr(\"opacity\", 0.5);\r\n      }\r\n\r\n      gGrafo = svg.append(\"g\");\r\n      gEnlaces = gGrafo.append(\"g\");\r\n      gNodos = gGrafo.append(\"g\").attr(\"class\", \"isolate\");\r\n\r\n      if (debug === true) {\r\n        gGrafo.attr(\"id\", \"gGrafo-\" + i);\r\n        gEnlaces.attr(\"id\", \"gEnlaces-\" + i);\r\n        gNodos.attr(\"id\", \"gNodos-\" + i);\r\n      }\r\n\r\n      var duplasURL = \"csv/grafos/\" + el.data(\"duplas\") + \".csv\";\r\n      var archivosCSV = [duplasURL];\r\n      var promesas = [];\r\n      _.each(archivosCSV, function (archivo) {\r\n        promesas.push(\r\n          d3.csv(archivo, function (d, i) {\r\n            return {\r\n              source: d.source,\r\n              target: d.target,\r\n              value: +d.weight,\r\n            };\r\n          })\r\n        );\r\n      });\r\n\r\n      Promise.all(promesas).then(function (values) {\r\n        var duplas = values[0];\r\n        setNodosYEnlaces(duplas);\r\n        setSimulacion();\r\n        setGrafo();\r\n        main();\r\n      });\r\n    }\r\n  }\r\n\r\n  function setNodosYEnlaces(duplas) {\r\n    var arreglo = [];\r\n    var id = null;\r\n    var obj = {};\r\n    _.each(duplas, function (d) {\r\n      arreglo = [];\r\n      arreglo.push(d.source);\r\n      arreglo.push(d.target);\r\n      arreglo = arreglo.sort(ordenaAlfabeticamente);\r\n      id = arreglo.join(\"_\");\r\n      if (obj.hasOwnProperty(id)) {\r\n        obj[id].value += d.value;\r\n      } else {\r\n        obj[id] = { source: d.source, target: d.target, value: d.value };\r\n      }\r\n    });\r\n    duplas = _.values(obj);\r\n    duplas = _.orderBy(\r\n      duplas,\r\n      [\"peso\", \"origen\", \"destino\"],\r\n      [\"desc\", \"asc\", \"asc\"]\r\n    );\r\n\r\n    obj = {};\r\n    _.each(duplas, function (d) {\r\n      if (!obj.hasOwnProperty(d.source)) {\r\n        obj[d.source] = {\r\n          id: d.source,\r\n          name: d.source,\r\n          tooltip: { color: \"#69b3a2\", contenido: \"<p>\" + d.source + \"</p>\" },\r\n          n: 1,\r\n        };\r\n      } else {\r\n        obj[d.source].n = obj[d.source].n + 1;\r\n      }\r\n      if (!obj.hasOwnProperty(d.target)) {\r\n        obj[d.target] = {\r\n          id: d.target,\r\n          name: d.target,\r\n          tooltip: { color: \"#69b3a2\", contenido: \"<p>\" + d.target + \"</p>\" },\r\n          n: 1,\r\n        };\r\n      } else {\r\n        obj[d.target].n = obj[d.target].n + 1;\r\n      }\r\n    });\r\n    arregloNodos = _.values(obj);\r\n    arregloEnlaces = duplas;\r\n  }\r\n\r\n  function ordenaAlfabeticamente(a, b) {\r\n    var nameA = a.toUpperCase();\r\n    var nameB = b.toUpperCase();\r\n    if (nameA < nameB) {\r\n      return -1;\r\n    }\r\n    if (nameA > nameB) {\r\n      return 1;\r\n    }\r\n    return 0;\r\n  }\r\n\r\n  function setSimulacion() {\r\n    var k = Math.sqrt(\r\n      arregloNodos.length / (principal.width * principal.height)\r\n    );\r\n    simulacion = d3\r\n      .forceSimulation(arregloNodos)\r\n      .force(\r\n        \"link\",\r\n        d3.forceLink(arregloEnlaces).id(function (d) {\r\n          return d.id;\r\n        })\r\n      )\r\n      .force(\"charge\", d3.forceManyBody().strength(-1.5 / k)) //mayor magnitud, mayor separación\r\n      .force(\"gravity\", d3.forceManyBody().strength(10 * k))\r\n      .force(\"x\", d3.forceX())\r\n      .force(\"y\", d3.forceY())\r\n      .force(\r\n        \"center\",\r\n        d3.forceCenter(principal.width / 2, principal.height / 2)\r\n      )\r\n      .force(\r\n        \"collision\",\r\n        d3.forceCollide().radius(function (d) {\r\n          return escalaRadio(d.n * 5);\r\n        })\r\n      );\r\n  }\r\n\r\n  function setGrafo() {\r\n    enlaces = gEnlaces\r\n      .selectAll(\"line\")\r\n      .data(arregloEnlaces)\r\n      .enter()\r\n      .append(\"line\")\r\n      .attr(\"stroke\", \"#eee\")\r\n      .attr(\"stroke-width\", 1);\r\n\r\n    nodos = gNodos\r\n      .selectAll(\"g\")\r\n      .data(arregloNodos)\r\n      .enter()\r\n      .append(\"g\")\r\n      .attr(\"class\", \"blend grab\")\r\n      .on(\"dblclick\", function (d) {\r\n        d.fx = null;\r\n        d.fy = null;\r\n        d3.select(this)\r\n          .select(\"circle\")\r\n          .attr(\"stroke\", \"#eee\")\r\n          .attr(\"stroke-width\", \"1px\");\r\n      })\r\n      .call(drag(simulacion));\r\n\r\n    nodos\r\n      .append(\"circle\")\r\n      .attr(\"r\", function (d) {\r\n        return escalaRadio(d.n);\r\n      })\r\n      .attr(\"fill\", function (d) {\r\n        return escalaColor(d.n / 10);\r\n      })\r\n      .attr(\"stroke\", \"#eee\")\r\n      .attr(\"stroke-width\", \"1px\");\r\n\r\n    nodos\r\n      .append(\"text\")\r\n      .text(function (d) {\r\n        return d.name;\r\n      })\r\n      .attr(\"text-anchor\", \"middle\")\r\n      .attr(\"dominant-baseline\", \"middle\")\r\n      .attr(\"y\", function (d) {\r\n        return escalaRadio(d.n) + d.n + 5;\r\n      })\r\n      .attr(\"font-size\", function (d) {\r\n        return d.n + 10;\r\n      })\r\n      .attr(\"fill\", \"#808080\");\r\n\r\n    simulacion.on(\"tick\", function () {\r\n      enlaces\r\n        .attr(\"x1\", function (d) {\r\n          return d.source.x;\r\n        })\r\n        .attr(\"y1\", function (d) {\r\n          return d.source.y;\r\n        })\r\n        .attr(\"x2\", function (d) {\r\n          return d.target.x;\r\n        })\r\n        .attr(\"y2\", function (d) {\r\n          return d.target.y;\r\n        });\r\n\r\n      nodos.attr(\"transform\", function (d) {\r\n        return \"translate(\" + d.x + \",\" + d.y + \")\";\r\n      });\r\n    });\r\n  }\r\n\r\n  function drag(s) {\r\n    function dragstarted(d) {\r\n      d3.select(this).attr(\"class\", \"blend grabbing\");\r\n      d3.select(this)\r\n        .select(\"circle\")\r\n        .attr(\"stroke\", \"#ccc\")\r\n        .attr(\"stroke-width\", \"2px\");\r\n      if (!d3.event.active) s.alphaTarget(0.3).restart();\r\n      d.fx = d.x;\r\n      d.fy = d.y;\r\n    }\r\n\r\n    function dragged(d) {\r\n      d.fx = d3.event.x;\r\n      d.fy = d3.event.y;\r\n    }\r\n\r\n    function dragended(d) {\r\n      d3.select(this).attr(\"class\", \"blend grab\");\r\n      if (!d3.event.active) s.alphaTarget(0);\r\n      d.fx = d3.event.x;\r\n      d.fy = d3.event.y;\r\n    }\r\n\r\n    return d3\r\n      .drag()\r\n      .on(\"start\", dragstarted)\r\n      .on(\"drag\", dragged)\r\n      .on(\"end\", dragended);\r\n  }\r\n\r\n  function main() {\r\n    //tooltips.generaTooltips(gNodos.selectAll(\"circle\"));\r\n    el.removeClass(\"espera\");\r\n  }\r\n\r\n  setup();\r\n};\r\n\r\nvar MapaDeFlujos = function (el, i) {\r\n  var debug = false;\r\n\r\n  var caja = Box({ content: { width: 1000, height: 600 } });\r\n\r\n  var contenedor = null;\r\n  var svg = null;\r\n  var gDefs = null;\r\n  var gMar = null;\r\n  var gPaises = null;\r\n  var gFlujos = null;\r\n\r\n  var datos = null;\r\n  var mundo = null;\r\n  var flujos = null;\r\n  var lugares = null;\r\n\r\n  var proyeccion = d3.geoMercator().scale(400).translate([850, 500]);\r\n\r\n  var path = d3.geoPath().projection(proyeccion);\r\n  var linea = d3\r\n    .line()\r\n    .x(function (d) {\r\n      return d[0];\r\n    })\r\n    .y(function (d) {\r\n      return d[1];\r\n    })\r\n    .curve(d3.curveBasis);\r\n\r\n  var escala = d3.scaleLog().range([1, 5]);\r\n\r\n  var limitesZoom = [1, 3];\r\n  var zoom = d3.zoom().scaleExtent(limitesZoom).on(\"zoom\", zoomed);\r\n\r\n  function setup() {\r\n    contenedor = d3.select(el[0]);\r\n    var flag = el.data(\"visualizacion\") || false;\r\n    if (flag === false) {\r\n      el.data(\"visualizacion\", true);\r\n      contenedor.selectAll(\"svg\").remove();\r\n      svg = contenedor\r\n        .append(\"svg\")\r\n        .attr(\"preserveAspectRatio\", \"xMidYMid\")\r\n        .attr(\"viewBox\", \"0 0 \" + caja.inner.width + \" \" + caja.inner.height)\r\n        .call(zoom);\r\n\r\n      el.attr(\"data-setup\", true);\r\n\r\n      if (debug === true) {\r\n        svg\r\n          .attr(\"id\", el.data(\"tipo-visualizacion\") + \"-\" + i)\r\n          .append(\"rect\")\r\n          .attr(\"fill\", \"yellow\")\r\n          .attr(\"opacity\", 0.5)\r\n          .attr(\"x\", 0)\r\n          .attr(\"y\", 0)\r\n          .attr(\"width\", caja.inner.width)\r\n          .attr(\"height\", caja.inner.height);\r\n      }\r\n\r\n      svg = svg\r\n        .append(\"g\")\r\n        .attr(\r\n          \"transform\",\r\n          \"translate(\" + caja.padding.left + \",\" + caja.padding.top + \")\"\r\n        );\r\n\r\n      if (debug === true) {\r\n        svg\r\n          .attr(\"class\", \"svg\")\r\n          .append(\"rect\")\r\n          .attr(\"width\", caja.content.width)\r\n          .attr(\"height\", caja.content.height)\r\n          .attr(\"fill\", \"blue\")\r\n          .attr(\"opacity\", 0.5);\r\n      }\r\n\r\n      gDefs = svg.append(\"g\");\r\n      gMar = svg.append(\"g\");\r\n      gPaises = svg.append(\"g\");\r\n      gFlujos = svg.append(\"g\");\r\n\r\n      if (debug === true) {\r\n        gDefs.attr(\"id\", \"gDefs-\" + i);\r\n        gMar.attr(\"id\", \"gMar-\" + i);\r\n        gPaises.attr(\"id\", \"gPaises-\" + i);\r\n        gFlujos.attr(\"id\", \"gFlujos-\" + i);\r\n      }\r\n\r\n      var lugaresURL = \"csv/\" + el.data(\"lugares\") + \".csv\";\r\n      var flujosURL = \"csv/\" + el.data(\"flujos\") + \".csv\";\r\n      var mapaURL = \"json/mundo.json\";\r\n      var promesas = [];\r\n\r\n      promesas.push(d3.json(mapaURL));\r\n      promesas.push(d3.csv(lugaresURL));\r\n      promesas.push(\r\n        d3.csv(flujosURL, function (d, i) {\r\n          return {\r\n            id: +d.id_noticia,\r\n            activo: true,\r\n            periodico: d.periodico,\r\n            noticia: d.noticia,\r\n            fuente: d.fuente,\r\n            enlace: d.enlace,\r\n            origen: {\r\n              fecha: funciones.getFecha(d.fecha_origen),\r\n              slug: d.origen,\r\n            },\r\n            destino: {\r\n              fecha: funciones.getFecha(d.fecha_destino),\r\n              slug: d.destino,\r\n            },\r\n            clave: d.origen + \"_\" + d.destino,\r\n            estilo: { color: \"#000000\", tamanio: 0 },\r\n            tooltip: {\r\n              color: \"#000000\",\r\n              contenido: null,\r\n            },\r\n          };\r\n        })\r\n      );\r\n      Promise.all(promesas).then(function (values) {\r\n        mundo = values[0];\r\n        lugares = agrupaLugares(values[1]);\r\n        flujos = agrupaFlujos(values[2]);\r\n        setEscala();\r\n        setMapa();\r\n        setGradientes();\r\n        setFlujos();\r\n        main();\r\n      });\r\n    }\r\n  }\r\n\r\n  function agrupaLugares(arreglo) {\r\n    var colores = d3.schemeCategory10;\r\n    var objetoColores = {};\r\n    var j = 0;\r\n    var obj = {};\r\n    _.each(arreglo, function (lugar, i) {\r\n      var pais = +lugar.pais;\r\n      if (!objetoColores.hasOwnProperty(pais)) {\r\n        objetoColores[pais] = d3.hsl(colores[j % colores.length]);\r\n        j++;\r\n      }\r\n      obj[lugar.slug] = {\r\n        slug: lugar.slug,\r\n        lugar: lugar.lugar,\r\n        coordenadas: proyeccion([lugar.longitud, lugar.latitud]),\r\n        coordenadasR: [lugar.longitud, lugar.latitud],\r\n        pais: pais,\r\n        nombrepais: lugar.nombrepais,\r\n        color: objetoColores[pais],\r\n      };\r\n    });\r\n    return obj;\r\n  }\r\n\r\n  function agrupaFlujos(datos) {\r\n    var flujos = {};\r\n    var obj = null;\r\n    var clave = null;\r\n    var xIni = null;\r\n    var yIni = null;\r\n    var deltaX = null;\r\n    var deltaY = null;\r\n    var origen = null;\r\n    var destino = null;\r\n    var ruta = null;\r\n    var puntos = null;\r\n    _.each(datos, function (d) {\r\n      clave = d.clave;\r\n      obj = flujos[clave] || false;\r\n      origen = lugares[d.origen.slug];\r\n      destino = lugares[d.destino.slug];\r\n      if (obj === false) {\r\n        flujos[clave] = {\r\n          clave: d.clave,\r\n          activo: d.activo,\r\n          destino: {\r\n            coordenadas: destino.coordenadas,\r\n            nombre: destino.lugar,\r\n            slug: destino.slug,\r\n            pais: destino.pais,\r\n            nombrepais: destino.nombrepais,\r\n            color: destino.color,\r\n            activo: true,\r\n          },\r\n          estilo: { color: d.estilo.color },\r\n          origen: {\r\n            coordenadas: origen.coordenadas,\r\n            nombre: origen.lugar,\r\n            slug: origen.slug,\r\n            pais: origen.pais,\r\n            nombrepais: origen.nombrepais,\r\n            color: origen.color,\r\n            activo: true,\r\n          },\r\n          tooltip: { color: d.estilo.color, contenido: null },\r\n          noticias: [],\r\n          puntos: [],\r\n        };\r\n        ruta = path({\r\n          type: \"LineString\",\r\n          coordinates: [origen.coordenadasR, destino.coordenadasR],\r\n        });\r\n        puntos = ruta.split(\"M\");\r\n        puntos = puntos[1].split(\"L\");\r\n        puntos = _.map(puntos, function (a) {\r\n          return a.split(\",\");\r\n        });\r\n        flujos[clave].puntos = puntos;\r\n      }\r\n      flujos[clave].noticias.push({\r\n        destino: { fecha: d.destino.fecha },\r\n        origen: { fecha: d.origen.fecha },\r\n        dias: (d.destino.fecha - d.origen.fecha) / (24 * 60 * 60 * 1000),\r\n        enlace: d.enlace,\r\n        estilo: { color: d.estilo.color },\r\n        fuente: d.fuente,\r\n        id: d.id,\r\n        noticia: d.noticia,\r\n        periodico: d.periodico,\r\n        tooltip: { color: d.estilo.color, contenido: null },\r\n      });\r\n    });\r\n    var contenido = null;\r\n    var aux = null;\r\n    var primeraenviada = null;\r\n    var primerarecibida = null;\r\n    var ultimaenviada = null;\r\n    var ultimarecibida = null;\r\n    return _.values(flujos);\r\n  }\r\n\r\n  function setEscala() {\r\n    var arreglo = _.map(flujos, function (f) {\r\n      return f.noticias.length;\r\n    });\r\n    var max = funciones.getNumeroBonito(_.max(arreglo));\r\n    escala.domain([1, max]);\r\n  }\r\n\r\n  function setMapa() {\r\n    gMar\r\n      .attr(\"fill\", \"#c6e6ec\")\r\n      .append(\"rect\")\r\n      .attr(\"width\", caja.content.width)\r\n      .attr(\"height\", caja.content.height);\r\n    gPaises\r\n      .attr(\"fill\", \"#efefef\")\r\n      .attr(\"stroke\", \"#ababab\")\r\n      .attr(\"stroke-width\", 1);\r\n\r\n    var paises = topojson.feature(mundo, mundo.objects.countries).features;\r\n    var objetoColores = {};\r\n    _.each(lugares, function (l, c) {\r\n      objetoColores[l.pais] = l.color;\r\n    });\r\n\r\n    gPaises\r\n      .selectAll(\"path\")\r\n      .data(paises)\r\n      .enter()\r\n      .insert(\"path\")\r\n      .attr(\"d\", path)\r\n      .attr(\"fill\", function (d) {\r\n        d.color = objetoColores.hasOwnProperty(d.id)\r\n          ? objetoColores[d.id]\r\n          : null;\r\n        return d.color;\r\n      })\r\n      .attr(\"class\", function (d) {\r\n        d.activo = objetoColores.hasOwnProperty(d.id) ? true : false;\r\n        return objetoColores.hasOwnProperty(d.id) ? \"activo\" : null;\r\n      });\r\n\r\n    gPaises.selectAll(\"path.activo\").on(\"click\", actualizaMapa);\r\n  }\r\n\r\n  function setGradientes() {\r\n    var gradientes = gDefs\r\n      .append(\"defs\")\r\n      .selectAll(\"linearGradient\")\r\n      .data(flujos)\r\n      .enter()\r\n      .append(\"linearGradient\")\r\n      .attr(\"gradientUnits\", \"userSpaceOnUse\")\r\n      .attr(\"id\", function (d) {\r\n        return \"gradiente-\" + d.origen.slug + \"-\" + d.destino.slug;\r\n      })\r\n      .attr(\"x1\", function (d) {\r\n        return d.origen.coordenadas[0];\r\n      })\r\n      .attr(\"y1\", function (d, i) {\r\n        return d.origen.coordenadas[1];\r\n      })\r\n      .attr(\"x2\", function (d, i) {\r\n        return d.destino.coordenadas[0];\r\n      })\r\n      .attr(\"y2\", function (d, i) {\r\n        return d.destino.coordenadas[1];\r\n      });\r\n\r\n    gradientes\r\n      .append(\"stop\")\r\n      .attr(\"offset\", \"0%\")\r\n      .attr(\"stop-color\", function (d) {\r\n        return d.origen.color;\r\n      });\r\n\r\n    gradientes\r\n      .append(\"stop\")\r\n      .attr(\"offset\", \"100%\")\r\n      .attr(\"stop-color\", function (d) {\r\n        return d.destino.color;\r\n      });\r\n  }\r\n\r\n  function setFlujos() {\r\n    var grupos = gFlujos\r\n      .style(\"mix-blend-mode\", \"multiply\")\r\n      .selectAll(\"g.flujo\")\r\n      .data(flujos)\r\n      .enter()\r\n      .insert(\"g\")\r\n      .attr(\"class\", \"flujo\");\r\n\r\n    grupos\r\n      .append(\"path\")\r\n      .attr(\"class\", \"invisible\")\r\n      .attr(\"d\", function (d) {\r\n        return linea(d.puntos);\r\n      })\r\n      .attr(\"shape-rendering\", \"geometricPrecision\")\r\n      .attr(\"stroke\", \"#ffffff\")\r\n      .style(\"stroke-width\", \"20px\")\r\n      .style(\"stroke-style\", \"solid\")\r\n      .attr(\"opacity\", 0)\r\n      .attr(\"fill\", \"none\")\r\n      .on(\"click\", actualizaFlujos)\r\n      .each(function (d) {\r\n        var opciones = tooltips.getOpciones();\r\n        var contenido = \"\";\r\n        var aux = [];\r\n        var primeraenviada = 0;\r\n        var primerarecibida = 0;\r\n        var ultimaenviada = 0;\r\n        var ultimarecibida = 0;\r\n        var opcionesFecha = {\r\n          year: \"numeric\",\r\n          month: \"long\",\r\n          day: \"numeric\",\r\n        };\r\n        contenido +=\r\n          '<h2><span style=\"color:' +\r\n          d.origen.color +\r\n          ';\">' +\r\n          d.origen.nombre +\r\n          \", \" +\r\n          d.origen.nombrepais +\r\n          '</span> - <span style=\"color:' +\r\n          d.destino.color +\r\n          ';\">' +\r\n          d.destino.nombre +\r\n          \", \" +\r\n          d.destino.nombrepais +\r\n          \"</span></h2>\";\r\n\r\n        contenido +=\r\n          \"<p>Se encontraron <strong>\" +\r\n          d.noticias.length +\r\n          \" noticias</strong> en este flujo</p>\";\r\n\r\n        aux = _.map(d.noticias, function (n) {\r\n          return n.origen.fecha;\r\n        });\r\n        primeraenviada = _.min(aux);\r\n        ultimaenviada = _.max(aux);\r\n\r\n        aux = _.map(d.noticias, function (n) {\r\n          return n.destino.fecha;\r\n        });\r\n        primerarecibida = _.min(aux);\r\n        ultimarecibida = _.max(aux);\r\n\r\n        contenido +=\r\n          \"<p>La primera noticia se envió el <strong>\" +\r\n          primeraenviada.toLocaleDateString(\"sp\", opcionesFecha) +\r\n          \"</strong> y se recibió el <strong>\" +\r\n          primerarecibida.toLocaleDateString(\"sp\", opcionesFecha) +\r\n          \"</strong></p>\";\r\n\r\n        contenido +=\r\n          \"<p>La última noticia se envió el <strong>\" +\r\n          ultimaenviada.toLocaleDateString(\"sp\", opcionesFecha) +\r\n          \"</strong> y se recibió el <strong>\" +\r\n          ultimarecibida.toLocaleDateString(\"sp\", opcionesFecha) +\r\n          \"</strong></p>\";\r\n        aux = _.map(d.noticias, \"dias\");\r\n        aux = Math.round(_.mean(aux));\r\n        contenido +=\r\n          \"<p>En promedio, las noticias tardaron <strong>\" +\r\n          aux +\r\n          \" días</strong> en llegar a su destino</p>\";\r\n        d.contenido = contenido;\r\n        opciones.content = $(contenido);\r\n        $(this).tooltipster(opciones);\r\n      });\r\n\r\n    grupos\r\n      .append(\"path\")\r\n      .attr(\"class\", \"flujo visible\")\r\n      .attr(\"d\", function (d) {\r\n        return linea(d.puntos);\r\n      })\r\n      .attr(\"shape-rendering\", \"geometricPrecision\")\r\n      .style(\"stroke-width\", 0)\r\n      .style(\"stroke-style\", \"solid\")\r\n      .style(\"stroke-linecap\", \"round\")\r\n      .style(\"stroke\", function (d) {\r\n        //return \"url(#gradiente-\" + d.origen.slug + \"-\" + d.destino.slug + \")\";\r\n        return d.origen.color;\r\n      })\r\n      .attr(\"opacity\", 0.8)\r\n      .attr(\"fill\", \"none\")\r\n      .each(function (d) {\r\n        d.largo = d3.select(this).node().getTotalLength();\r\n      })\r\n      .attr(\"stroke-dasharray\", function (d) {\r\n        return d.largo + \" \" + d.largo;\r\n      })\r\n      .attr(\"stroke-dashoffset\", function (d) {\r\n        return d.largo;\r\n      })\r\n      .transition()\r\n      .duration(1500)\r\n      .ease(d3.easeLinear)\r\n      .attr(\"stroke-dashoffset\", 0)\r\n      .style(\"stroke-width\", function (d) {\r\n        return escala(d.noticias.length) + \"px\";\r\n      });\r\n  }\r\n\r\n  function main() {\r\n    //tooltips.generaTooltips(gFlujos.selectAll(\"path\"));\r\n    el.removeClass(\"espera\");\r\n  }\r\n\r\n  function zoomed() {\r\n    gPaises.style(\"stroke-width\", 1 / d3.event.transform.k + \"px\");\r\n    gFlujos\r\n      .selectAll(\"path.invisible\")\r\n      .style(\"stroke-width\", 20 / d3.event.transform.k + \"px\");\r\n    gFlujos.selectAll(\"path.visible\").style(\"stroke-width\", function (d) {\r\n      return escala(d.noticias.length) / d3.event.transform.k + \"px\";\r\n    });\r\n    gPaises.attr(\"transform\", d3.event.transform);\r\n    gFlujos.attr(\"transform\", d3.event.transform);\r\n    gFlujos.selectAll(\"path.invisible\").each(function (d) {\r\n      $(this).tooltipster(\"content\", $(d.contenido));\r\n    });\r\n  }\r\n\r\n  function actualizaMapa(d) {\r\n    var path = d3.select(this);\r\n    var fs = null;\r\n    var fsa = null;\r\n    var fsp = null;\r\n    var claves = [];\r\n    var ids = [];\r\n    d.activo = !d.activo;\r\n    path\r\n      .transition()\r\n      .duration(400)\r\n      .attr(\"fill\", function (d) {\r\n        return d.activo ? d.color : rebajaColor(d.color);\r\n      });\r\n    fs = _.filter(flujos, function (f) {\r\n      return f.origen.pais === d.id || f.destino.pais === d.id;\r\n    });\r\n    _.each(fs, function (f) {\r\n      claves.push(f.clave);\r\n      if (f.origen.pais === d.id) {\r\n        f.origen.activo = d.activo;\r\n      }\r\n      if (f.destino.pais === d.id) {\r\n        f.destino.activo = d.activo;\r\n      }\r\n    });\r\n\r\n    gFlujos\r\n      .selectAll(\"path.visible\")\r\n      .filter(function (df) {\r\n        return claves.indexOf(df.clave) >= 0;\r\n      })\r\n      .transition()\r\n      .duration(400)\r\n      .attr(\"opacity\", function (df) {\r\n        return df.activo && df.origen.activo && df.destino.activo ? 0.8 : 0.2;\r\n      });\r\n\r\n    fsa = _.filter(fs, function (f) {\r\n      return f.activo;\r\n    });\r\n\r\n    _.each(fsa, function (fa) {\r\n      if (fa.origen.activo) {\r\n        ids.push(fa.origen.pais);\r\n      }\r\n      if (fa.destino.activo) {\r\n        ids.push(fa.destino.pais);\r\n      }\r\n    });\r\n    ids = _.uniq(ids);\r\n\r\n    var fsp = _.filter(flujos, function (f) {\r\n      return (\r\n        f.activo &&\r\n        f.destino.activo &&\r\n        f.origen.activo &&\r\n        (ids.indexOf(f.origen.pais) >= 0 || ids.indexOf(f.destino.pais) >= 0)\r\n      );\r\n    });\r\n\r\n    gPaises\r\n      .selectAll(\"path.activo\")\r\n      .filter(function (dp) {\r\n        return dp.activo && ids.indexOf(dp.id) >= 0;\r\n      })\r\n      .transition()\r\n      .duration(400)\r\n      .attr(\"fill\", function (dp) {\r\n        var entrantes = _.filter(fsp, function (fa) {\r\n          return fa.destino.pais == dp.id;\r\n        });\r\n        var salientes = _.filter(fsp, function (fa) {\r\n          return fa.origen.pais == dp.id;\r\n        });\r\n        return dp.activo && (entrantes.length > 0 || salientes.length > 0)\r\n          ? dp.color\r\n          : rebajaColor(dp.color);\r\n      });\r\n  }\r\n\r\n  function actualizaFlujos(d) {\r\n    var g = d3.select(this.parentNode);\r\n    var path = g.select(\"path.flujo.visible\");\r\n    var ps = null;\r\n    var fs = null;\r\n    d.activo = !d.activo;\r\n\r\n    path\r\n      .transition()\r\n      .duration(400)\r\n      .attr(\"opacity\", function (df) {\r\n        //return df.activo && df.origen.activo && df.destino.activo ? 1 : 0.2;\r\n        return df.activo ? 0.8 : 0.2;\r\n      });\r\n\r\n    fs = _.filter(flujos, function (f) {\r\n      return (\r\n        f.activo &&\r\n        (f.origen.pais === d.origen.pais ||\r\n          f.destino.pais === d.origen.pais ||\r\n          f.origen.pais === d.destino.pais ||\r\n          f.destino.pais === d.destino.pais)\r\n      );\r\n    });\r\n\r\n    ps = gPaises\r\n      .selectAll(\"path.activo\")\r\n      .filter(function (dp) {\r\n        return dp.id === d.origen.pais || dp.id === d.destino.pais;\r\n      })\r\n      .transition()\r\n      .duration(400)\r\n      .attr(\"fill\", function (dp) {\r\n        var entrantes = _.filter(fs, function (f) {\r\n          return f.destino.pais === dp.id;\r\n        });\r\n        var salientes = _.filter(fs, function (f) {\r\n          return f.origen.pais === dp.id;\r\n        });\r\n        if (dp.activo === false) {\r\n          if (entrantes.length > 0 || salientes.length > 0) {\r\n            dp.activo = true;\r\n          }\r\n        }\r\n        return dp.activo && (entrantes.length > 0 || salientes.length > 0)\r\n          ? dp.color\r\n          : rebajaColor(dp.color);\r\n      });\r\n  }\r\n\r\n  function rebajaColor(color) {\r\n    var n = d3.hsl(color.h, color.s - 0.3, 0.8);\r\n    return n;\r\n  }\r\n\r\n  setup();\r\n};\r\n\r\nvar MapaDeNoticias = function (el, i) {\r\n  var debug = false;\r\n\r\n  var idDestino = 484;\r\n\r\n  var offset = 20;\r\n  var caja = Box({\r\n    content: { width: 1600, height: 960 },\r\n    padding: offset,\r\n  });\r\n  var cajaMapa = Box({ content: { width: 1000, height: 600 } });\r\n  var cajaGrafica = Box({\r\n    content: { width: 600 - offset, height: 500 },\r\n    margin: { top: 0, right: offset, bottom: 0, left: 0 },\r\n  });\r\n\r\n  var cajaResumen = Box({\r\n    content: { width: 1600, height: 960 - (600 + offset) },\r\n  });\r\n\r\n  var contenedor = null;\r\n  var svg = null;\r\n\r\n  var svgMapa = null;\r\n  var gMar = null;\r\n  var gPaises = null;\r\n  var gFlujos = null;\r\n\r\n  var svgGrafica = null;\r\n  var gEjes = null;\r\n  var gLineas = null;\r\n  var gNoticias = null;\r\n  var gControles = null;\r\n  var gLeyendas = null;\r\n\r\n  var svgResumen = null;\r\n  var simbolo = d3.symbol().type(d3.symbolDiamond);\r\n\r\n  var svgSlider = null;\r\n  var fechaSlider = null;\r\n  var controlSlider = null;\r\n  var intervalo = null;\r\n\r\n  var noticias = null;\r\n  var mundo = null;\r\n  var flujos = null;\r\n  var lugares = null;\r\n  var paises = null;\r\n  var origenes = null;\r\n  var alturaEjes = 450;\r\n  var rangoFechas = null;\r\n  var escalaEjes = d3.scaleLinear().range([10, alturaEjes - 10]);\r\n  var escalaResumen = d3.scaleLinear().domain([0, 300]).range([0, 15000]);\r\n  var escalaHorizontal = d3.scaleLinear().domain([0, 530]).range([0, 100]);\r\n  var escalaFechas = d3.scaleLinear();\r\n\r\n  var arregloDeNoticias = null;\r\n  var periodos = null;\r\n  var fechasEnvio = null;\r\n  var fechasRecepcion = null;\r\n\r\n  var proyeccion = d3.geoMercator().scale(400).translate([885, 570]);\r\n\r\n  var path = d3.geoPath().projection(proyeccion);\r\n  var linea = d3\r\n    .line()\r\n    .x(function (d) {\r\n      return d[0];\r\n    })\r\n    .y(function (d) {\r\n      return d[1];\r\n    })\r\n    .curve(d3.curveBasis);\r\n\r\n  var escala = d3.scaleLog().range([1, 5]);\r\n\r\n  var limitesZoom = [1, 3];\r\n  var zoom = d3.zoom().scaleExtent(limitesZoom).on(\"zoom\", zoomed);\r\n  var drag = d3\r\n    .drag()\r\n    .on(\"start\", dragstarted)\r\n    .on(\"drag\", dragged)\r\n    .on(\"end\", dragended);\r\n\r\n  function setup() {\r\n    contenedor = d3.select(el[0]);\r\n    var flag = el.data(\"visualizacion\") || false;\r\n    if (flag === false) {\r\n      el.data(\"visualizacion\", true);\r\n      contenedor.selectAll(\"svg\").remove();\r\n      svg = contenedor\r\n        .append(\"svg\")\r\n        .attr(\"preserveAspectRatio\", \"xMidYMid\")\r\n        .attr(\"viewBox\", \"0 0 \" + caja.inner.width + \" \" + caja.inner.height);\r\n\r\n      el.attr(\"data-setup\", true);\r\n\r\n      if (debug === true) {\r\n        svg\r\n          .attr(\"id\", el.data(\"tipo-visualizacion\") + \"-\" + i)\r\n          .append(\"rect\")\r\n          .attr(\"fill\", \"yellow\")\r\n          .attr(\"opacity\", 0.5)\r\n          .attr(\"x\", 0)\r\n          .attr(\"y\", 0)\r\n          .attr(\"width\", caja.inner.width)\r\n          .attr(\"height\", caja.inner.height);\r\n      }\r\n\r\n      var gMapaAux = svg\r\n        .append(\"g\")\r\n        .attr(\r\n          \"transform\",\r\n          \"translate(\" +\r\n            (caja.padding.left + cajaGrafica.outter.width) +\r\n            \",\" +\r\n            caja.padding.top +\r\n            \")\"\r\n        );\r\n\r\n      svgMapa = gMapaAux\r\n        .append(\"svg\")\r\n        .attr(\"width\", cajaMapa.inner.width)\r\n        .attr(\"height\", cajaMapa.inner.height)\r\n        .call(zoom);\r\n\r\n      if (debug === true) {\r\n        svgMapa.attr(\"id\", \"svgMapa-\" + i);\r\n      }\r\n\r\n      svgMapa = svgMapa\r\n        .append(\"g\")\r\n        .attr(\r\n          \"transform\",\r\n          \"translate(\" +\r\n            cajaMapa.padding.left +\r\n            \",\" +\r\n            cajaMapa.padding.top +\r\n            \")\"\r\n        );\r\n\r\n      if (debug === true) {\r\n        svgMapa\r\n          .attr(\"class\", \"svg\")\r\n          .append(\"rect\")\r\n          .attr(\"width\", cajaMapa.content.width)\r\n          .attr(\"height\", cajaMapa.content.height)\r\n          .attr(\"fill\", \"blue\")\r\n          .attr(\"opacity\", 0.5);\r\n      }\r\n\r\n      gMar = svgMapa.append(\"g\");\r\n      gPaises = svgMapa.append(\"g\");\r\n      gFlujos = svgMapa.append(\"g\");\r\n\r\n      if (debug === true) {\r\n        gMar.attr(\"id\", \"gMar-\" + i);\r\n        gPaises.attr(\"id\", \"gPaises-\" + i);\r\n        gFlujos.attr(\"id\", \"gFlujos-\" + i);\r\n      }\r\n\r\n      svgGrafica = svg\r\n        .append(\"g\")\r\n        .attr(\r\n          \"transform\",\r\n          \"translate(\" + caja.padding.left + \",\" + caja.padding.top + \")\"\r\n        );\r\n\r\n      if (debug === true) {\r\n        svgGrafica.attr(\"id\", \"svgGrafica-\" + i);\r\n        svgGrafica\r\n          .attr(\"class\", \"svg\")\r\n          .append(\"rect\")\r\n          .attr(\"width\", cajaGrafica.inner.width)\r\n          .attr(\"height\", cajaGrafica.inner.height)\r\n          .attr(\"fill\", \"red\")\r\n          .attr(\"opacity\", 0.5);\r\n      }\r\n\r\n      gEjes = svgGrafica.append(\"g\");\r\n      gLineas = gEjes.append(\"g\").attr(\"transform\", \"translate(0,40)\");\r\n      gNoticias = gEjes\r\n        .append(\"g\")\r\n        .attr(\"transform\", \"translate(0,40)\")\r\n        .attr(\"class\", \"isolate\");\r\n      gControles = svgGrafica.append(\"g\");\r\n      gLeyendas = svgGrafica.append(\"g\");\r\n\r\n      if (debug === true) {\r\n        gEjes.attr(\"id\", \"gEjes-\" + i);\r\n        gControles.attr(\"id\", \"gControles-\" + i);\r\n        gLeyendas.attr(\"id\", \"gLeyendas-\" + i);\r\n        gNoticias.attr(\"id\", \"gNoticias-\" + i);\r\n        gLineas.attr(\"id\", \"gLineas-\" + i);\r\n      }\r\n\r\n      svgResumen = svg\r\n        .append(\"g\")\r\n        .attr(\"transform\", \"translate(\" + caja.padding.left + \",\" + 640 + \")\");\r\n\r\n      if (debug === true) {\r\n        svgResumen.attr(\"id\", \"svgResumen-\" + i);\r\n        svgResumen\r\n          .append(\"rect\")\r\n          .attr(\"fill\", \"green\")\r\n          .attr(\"width\", 1600)\r\n          .attr(\"height\", 340);\r\n      }\r\n\r\n      svgSlider = svg\r\n        .append(\"g\")\r\n        .attr(\"transform\", \"translate(\" + caja.padding.left + \",\" + 540 + \")\");\r\n\r\n      if (debug === true) {\r\n        svgSlider.attr(\"id\", \"svgSlider-\" + i);\r\n        svgSlider\r\n          .append(\"rect\")\r\n          .attr(\"fill\", \"purple\")\r\n          .attr(\"width\", 580)\r\n          .attr(\"height\", 80);\r\n      }\r\n\r\n      var lugaresURL = \"csv/\" + el.data(\"lugares\") + \".csv\";\r\n      var noticiasURL = \"csv/\" + el.data(\"noticias\") + \".csv\";\r\n      var mapaURL = \"json/mundo.json\";\r\n      var promesas = [];\r\n\r\n      promesas.push(d3.json(mapaURL));\r\n      promesas.push(d3.csv(lugaresURL));\r\n      promesas.push(\r\n        d3.csv(noticiasURL, function (d, i) {\r\n          return {\r\n            id: +d.id_noticia,\r\n            activo: true,\r\n            periodico: d.periodico,\r\n            noticia: d.noticia,\r\n            fuente: d.fuente,\r\n            enlace: d.enlace,\r\n            origen: {\r\n              fecha: funciones.getFecha(d.fecha_origen),\r\n              slug: d.origen,\r\n            },\r\n            destino: {\r\n              fechaPadding: funciones.getFecha(d.fecha_destino, \"fin\"),\r\n              fecha: funciones.getFecha(d.fecha_destino),\r\n              slug: d.destino,\r\n            },\r\n            clave: d.origen + \"_\" + d.destino,\r\n            estilo: { color: \"#000000\", tamanio: 0 },\r\n            tooltip: {\r\n              color: \"#000000\",\r\n              contenido: null,\r\n            },\r\n          };\r\n        })\r\n      );\r\n      Promise.all(promesas).then(function (values) {\r\n        mundo = values[0];\r\n        lugares = agrupaLugares(values[1]);\r\n        paises = agrupaPaises(lugares);\r\n        rangoFechas = getRango(values[2]);\r\n        arregloDeNoticias = completaNoticias(values[2]);\r\n        flujos = agrupaFlujos(values[2]); // <-- flujos --> noticias\r\n        periodos = agrupaPeriodos(values[2]);\r\n        getFechas(values[2]);\r\n        noticias = values[2];\r\n        //noticiasPorPais = getNoticiasPorPais(values[2]);\r\n        setEscala();\r\n        setMapa();\r\n        setOrigenes();\r\n        setControles();\r\n        setEscalaEjes();\r\n        setEjes();\r\n        setLeyendas();\r\n        setPendientes();\r\n        setFlujos();\r\n        setSlider();\r\n        setResumen();\r\n        main();\r\n      });\r\n    }\r\n  }\r\n\r\n  function agrupaLugares(arreglo) {\r\n    var escalaColor = d3.interpolateRainbow;\r\n    var escala = d3.scaleLinear();\r\n    var color = null;\r\n    var j = 0;\r\n    var obj = {};\r\n    var paises = _.map(arreglo, function (p) {\r\n      return +p.pais;\r\n    });\r\n    paises = _.uniq(paises);\r\n    escala.domain([0, paises.length]);\r\n    _.each(arreglo, function (lugar) {\r\n      lugar.pais = +lugar.pais;\r\n      j = _.indexOf(paises, lugar.pais);\r\n      color = escalaColor((escala(j) + 0.9) % paises.length);\r\n      obj[lugar.slug] = {\r\n        slug: lugar.slug,\r\n        lugar: lugar.lugar,\r\n        coordenadas: proyeccion([lugar.longitud, lugar.latitud]),\r\n        coordenadasR: [lugar.longitud, lugar.latitud],\r\n        pais: lugar.pais,\r\n        nombrepais: lugar.nombrepais,\r\n        color: d3.hsl(color),\r\n      };\r\n    });\r\n    return obj;\r\n  }\r\n\r\n  function agrupaPaises(objeto) {\r\n    var arreglo = _.values(objeto);\r\n    arreglo = _.map(arreglo, function (o) {\r\n      return {\r\n        color: o.color,\r\n        nombrepais: o.nombrepais,\r\n        pais: o.pais,\r\n        activo: true,\r\n      };\r\n    });\r\n    arreglo = _.uniqBy(arreglo, \"pais\");\r\n    return arreglo;\r\n  }\r\n\r\n  function agrupaPeriodos(datos) {\r\n    var periodos = {};\r\n    var obj = null;\r\n    var clave = null;\r\n    _.each(datos, function (d) {\r\n      clave = d.origen.fecha.getTime() + \"-\" + d.destino.fecha.getTime();\r\n      obj = periodos[clave] || false;\r\n      if (obj === false) {\r\n        periodos[clave] = {\r\n          clave: clave,\r\n          activo: true,\r\n          noticias: [],\r\n          dias: [\r\n            (d.origen.fecha - rangoFechas[0]) / (24 * 60 * 60 * 1000),\r\n            (d.destino.fecha - rangoFechas[0]) / (24 * 60 * 60 * 1000),\r\n          ],\r\n          origen: d.origen.fecha,\r\n          destino: d.destino.fecha,\r\n          destinoPadding: d.destino.fechaPadding,\r\n        };\r\n      }\r\n      periodos[clave].noticias.push(d);\r\n    });\r\n    return _.values(periodos);\r\n  }\r\n\r\n  function getFechas(datos) {\r\n    fechasEnvio = _.map(datos, function (d) {\r\n      return (d.origen.fecha - rangoFechas[0]) / (24 * 60 * 60 * 1000);\r\n    });\r\n    fechasEnvio = _.uniq(fechasEnvio);\r\n    /*\r\n    fechasEnvio = _.uniqBy(fechasEnvio, function(d) {\r\n      return d.getTime();\r\n    });\r\n    fechasEnvio = _.orderBy(fechasEnvio, function(d) {\r\n      return d.getTime();\r\n    });\r\n    */\r\n    fechasRecepcion = _.map(datos, function (d) {\r\n      return (d.destino.fecha - rangoFechas[0]) / (24 * 60 * 60 * 1000);\r\n    });\r\n    fechasRecepcion = _.uniq(fechasRecepcion);\r\n    /*\r\n    fechasRecepcion = _.uniqBy(fechasRecepcion, function(d) {\r\n      return d.getTime();\r\n    });\r\n    fechasRecepcion = _.orderBy(fechasRecepcion, function(d) {\r\n      return d.getTime();\r\n    });\r\n    */\r\n  }\r\n\r\n  function agrupaFlujos(datos) {\r\n    var flujos = {};\r\n    var obj = null;\r\n    var clave = null;\r\n    var xIni = null;\r\n    var yIni = null;\r\n    var deltaX = null;\r\n    var deltaY = null;\r\n    var origen = null;\r\n    var destino = null;\r\n    var ruta = null;\r\n    var puntos = null;\r\n    _.each(datos, function (d) {\r\n      clave = d.clave;\r\n      obj = flujos[clave] || false;\r\n      origen = lugares[d.origen.slug];\r\n      destino = lugares[d.destino.slug];\r\n      if (obj === false) {\r\n        flujos[clave] = {\r\n          clave: d.clave,\r\n          activo: d.activo,\r\n          destino: {\r\n            coordenadas: destino.coordenadas,\r\n            nombre: destino.lugar,\r\n            slug: destino.slug,\r\n            pais: destino.pais,\r\n            nombrepais: destino.nombrepais,\r\n            color: destino.color,\r\n            activo: true,\r\n          },\r\n          estilo: { color: d.estilo.color },\r\n          origen: {\r\n            coordenadas: origen.coordenadas,\r\n            nombre: origen.lugar,\r\n            slug: origen.slug,\r\n            pais: origen.pais,\r\n            nombrepais: origen.nombrepais,\r\n            color: origen.color,\r\n            activo: true,\r\n          },\r\n          tooltip: { color: d.estilo.color, contenido: null },\r\n          noticias: [],\r\n          puntos: [],\r\n        };\r\n        ruta = path({\r\n          type: \"LineString\",\r\n          coordinates: [origen.coordenadasR, destino.coordenadasR],\r\n        });\r\n        puntos = ruta.split(\"M\");\r\n        puntos = puntos[1].split(\"L\");\r\n        puntos = _.map(puntos, function (a) {\r\n          return a.split(\",\");\r\n        });\r\n        flujos[clave].puntos = puntos;\r\n      }\r\n      flujos[clave].noticias.push({\r\n        destino: { fecha: d.destino.fecha },\r\n        origen: { fecha: d.origen.fecha },\r\n        dias: (d.destino.fecha - d.origen.fecha) / (24 * 60 * 60 * 1000),\r\n        enlace: d.enlace,\r\n        estilo: { color: d.estilo.color },\r\n        fuente: d.fuente,\r\n        id: d.id,\r\n        noticia: d.noticia,\r\n        periodico: d.periodico,\r\n        tooltip: { color: d.estilo.color, contenido: null },\r\n      });\r\n    });\r\n    var contenido = null;\r\n    var aux = null;\r\n    var primeraenviada = null;\r\n    var primerarecibida = null;\r\n    var ultimaenviada = null;\r\n    var ultimarecibida = null;\r\n    return _.values(flujos);\r\n  }\r\n\r\n  function completaNoticias(arreglo) {\r\n    _.each(arreglo, function (d) {\r\n      d.origen.pais = lugares[d.origen.slug].pais;\r\n      d.destino.pais = lugares[d.destino.slug].pais;\r\n      d.color = lugares[d.origen.slug].color;\r\n      d.dias = [\r\n        (d.origen.fecha - rangoFechas[0]) / (24 * 60 * 60 * 1000),\r\n        (d.destino.fecha - rangoFechas[0]) / (24 * 60 * 60 * 1000),\r\n      ];\r\n    });\r\n    return arreglo;\r\n  }\r\n\r\n  function getRango(arreglo) {\r\n    var rango = [];\r\n    var envios = _.map(arreglo, function (d) {\r\n      return d.origen.fecha;\r\n    });\r\n    rango.push(_.min(envios));\r\n    var recepciones = _.map(arreglo, function (d) {\r\n      return d.destino.fecha;\r\n    });\r\n    rango.push(_.max(recepciones));\r\n    return rango;\r\n  }\r\n\r\n  function getNoticiasPorPais(arreglo) {\r\n    var noticias = _.groupBy();\r\n    return noticias;\r\n  }\r\n\r\n  function setEscala() {\r\n    var arreglo = _.map(flujos, function (f) {\r\n      return f.noticias.length;\r\n    });\r\n    var max = funciones.getNumeroBonito(_.max(arreglo));\r\n    escala.domain([1, max]);\r\n  }\r\n\r\n  function setMapa() {\r\n    gMar\r\n      .attr(\"fill\", \"#c6e6ec\")\r\n      .append(\"rect\")\r\n      .attr(\"width\", cajaMapa.content.width)\r\n      .attr(\"height\", cajaMapa.content.height);\r\n    gPaises\r\n      .attr(\"fill\", \"#efefef\")\r\n      .attr(\"stroke\", \"#ababab\")\r\n      .attr(\"stroke-width\", 1);\r\n\r\n    var paises = topojson.feature(mundo, mundo.objects.countries).features;\r\n    var objetoColores = {};\r\n    _.each(lugares, function (l, c) {\r\n      objetoColores[l.pais] = l.color;\r\n    });\r\n\r\n    gPaises\r\n      .selectAll(\"path\")\r\n      .data(paises)\r\n      .enter()\r\n      .insert(\"path\")\r\n      .attr(\"d\", path)\r\n      .attr(\"fill\", function (d) {\r\n        d.color = objetoColores.hasOwnProperty(d.id)\r\n          ? objetoColores[d.id]\r\n          : null;\r\n        return d.color;\r\n      })\r\n      .attr(\"class\", function (d) {\r\n        d.activo = objetoColores.hasOwnProperty(d.id) ? true : false;\r\n        return objetoColores.hasOwnProperty(d.id) ? \"activo\" : null;\r\n      });\r\n\r\n    gPaises\r\n      .selectAll(\"path.activo\")\r\n      .filter(function (d) {\r\n        return d.id !== idDestino;\r\n      })\r\n      .on(\"click\", actualizaPais);\r\n  }\r\n\r\n  function setOrigenes() {\r\n    origenes = _.filter(paises, function (d) {\r\n      return d.pais !== idDestino;\r\n    });\r\n    origenes = _.sortBy(origenes, \"nombrepais\");\r\n    _.each(origenes, function (p) {\r\n      p.noticiasOrigen = [];\r\n      p.noticiasDestino = [];\r\n      p.noticias = _.filter(noticias, function (n) {\r\n        return n.origen.pais == p.pais;\r\n      });\r\n    });\r\n  }\r\n\r\n  function setControles() {\r\n    var radio = 11;\r\n    gControles.attr(\"fill\", \"#ababab\").attr(\"stroke-width\", 1);\r\n    gControles\r\n      .append(\"text\")\r\n      .attr(\"x\", 0)\r\n      .attr(\"y\", 0)\r\n      .attr(\"dominant-baseline\", \"hanging\")\r\n      .text(\"Países\")\r\n      .attr(\"font-size\", 30);\r\n\r\n    var g = gControles\r\n      .append(\"g\")\r\n      .attr(\"transform\", \"translate(\" + radio + \",60)\");\r\n\r\n    var grupos = g\r\n      .selectAll(\"g\")\r\n      .data(origenes)\r\n      .enter()\r\n      .insert(\"g\")\r\n      .attr(\"transform\", function (d, i) {\r\n        return \"translate(0,\" + i * 30 + \")\";\r\n      })\r\n      .on(\"click\", function (d) {}); // TODO: Cambiar la función del click\r\n\r\n    grupos\r\n      .append(\"circle\")\r\n      .attr(\"r\", radio)\r\n      .attr(\"fill\", function (d) {\r\n        return d.color;\r\n      });\r\n    grupos\r\n      .append(\"text\")\r\n      .text(function (d) {\r\n        return d.nombrepais;\r\n      })\r\n      /*\r\n      .attr(\"fill\", function(d) {\r\n        return d.color;\r\n      })\r\n      */\r\n      .attr(\"x\", 10 + 5)\r\n      .attr(\"y\", 1)\r\n      .attr(\"dominant-baseline\", \"middle\");\r\n  }\r\n\r\n  function setEscalaEjes() {\r\n    var dias = (rangoFechas[1] - rangoFechas[0]) / (24 * 60 * 60 * 1000);\r\n    escalaEjes.domain([0, dias]);\r\n  }\r\n\r\n  function setEjes() {\r\n    var ancho = 150;\r\n    var offset = 100;\r\n    var xIni = cajaGrafica.inner.width / 2 - ancho / 2 + offset;\r\n    var xFin = cajaGrafica.inner.width / 2 + ancho / 2 + offset;\r\n\r\n    gLeyendas.attr(\"fill\", \"#ababab\").attr(\"stroke-width\", 1);\r\n    gLeyendas\r\n      .append(\"text\")\r\n      .attr(\"x\", xIni)\r\n      .attr(\"y\", 11)\r\n      .attr(\"text-anchor\", \"middle\")\r\n      .attr(\"dominant-baseline\", \"hanging\")\r\n      .text(\"Envío\")\r\n      .attr(\"font-size\", 20);\r\n\r\n    gLeyendas\r\n      .append(\"text\")\r\n      .attr(\"x\", xFin)\r\n      .attr(\"y\", 11)\r\n      .attr(\"text-anchor\", \"middle\")\r\n      .attr(\"dominant-baseline\", \"hanging\")\r\n      .text(\"Recepción\")\r\n      .attr(\"font-size\", 20);\r\n\r\n    gLineas.attr(\"stroke\", \"#efefef\").attr(\"stroke-width\", 1);\r\n\r\n    gLineas\r\n      .append(\"line\")\r\n      .attr(\"stroke\", \"#ababab\")\r\n      .attr(\"x1\", xIni)\r\n      .attr(\"y1\", 0)\r\n      .attr(\"x2\", xIni)\r\n      .attr(\"y2\", alturaEjes);\r\n    gLineas\r\n      .append(\"line\")\r\n      .attr(\"stroke\", \"#ababab\")\r\n      .attr(\"x1\", xFin)\r\n      .attr(\"y1\", 0)\r\n      .attr(\"x2\", xFin)\r\n      .attr(\"y2\", alturaEjes);\r\n\r\n    var min = _.min(fechasEnvio);\r\n    var max = _.max(fechasRecepcion);\r\n    var arregloFechas = _.range(min, max + 1);\r\n\r\n    gLineas\r\n      .selectAll(\"line.envio\")\r\n      //.data(fechasEnvio)\r\n      .data(arregloFechas)\r\n      .enter()\r\n      .insert(\"line\")\r\n      .attr(\"class\", \"envio\")\r\n      .attr(\"x1\", xIni - 10)\r\n      .attr(\"y1\", function (d) {\r\n        return escalaEjes(d);\r\n      })\r\n      .attr(\"x2\", xIni)\r\n      .attr(\"y2\", function (d) {\r\n        return escalaEjes(d);\r\n      });\r\n\r\n    gLineas\r\n      .selectAll(\"line.recepcion\")\r\n      //.data(fechasRecepcion)\r\n      .data(arregloFechas)\r\n      .enter()\r\n      .insert(\"line\")\r\n      .attr(\"class\", \"recepcion\")\r\n      .attr(\"x1\", xFin)\r\n      .attr(\"y1\", function (d) {\r\n        return escalaEjes(d);\r\n      })\r\n      .attr(\"x2\", xFin + 10)\r\n      .attr(\"y2\", function (d) {\r\n        return escalaEjes(d);\r\n      });\r\n\r\n    gLineas\r\n      .selectAll(\"text.envio\")\r\n      //.data(fechasEnvio)\r\n      .data(arregloFechas)\r\n      .enter()\r\n      .insert(\"text\")\r\n      .attr(\"class\", \"envio\")\r\n      .attr(\"font-size\", 11)\r\n      .attr(\"text-anchor\", \"end\")\r\n      .attr(\"stroke\", \"#ababab\")\r\n      .attr(\"stroke-width\", 0)\r\n      .attr(\"fill\", \"#ababab\")\r\n      .attr(\"x\", xIni - 15)\r\n      .attr(\"y\", function (d) {\r\n        return escalaEjes(d) + 2;\r\n      })\r\n      .text(function (d) {\r\n        var fecha = new Date(rangoFechas[0]);\r\n        fecha.setDate(fecha.getDate() + d);\r\n        return fecha.toLocaleDateString();\r\n      });\r\n\r\n    gLineas\r\n      .selectAll(\"text.recepcion\")\r\n      //.data(fechasRecepcion)\r\n      .data(arregloFechas)\r\n      .enter()\r\n      .insert(\"text\")\r\n      .attr(\"class\", \"recepcion\")\r\n      .attr(\"font-size\", 11)\r\n      .attr(\"text-anchor\", \"start\")\r\n      .attr(\"stroke\", \"#ababab\")\r\n      .attr(\"stroke-width\", 0)\r\n      .attr(\"fill\", \"#ababab\")\r\n      .attr(\"x\", xFin + 15)\r\n      .attr(\"y\", function (d) {\r\n        return escalaEjes(d) + 2;\r\n      })\r\n      .text(function (d) {\r\n        var fecha = new Date(rangoFechas[0]);\r\n        fecha.setDate(fecha.getDate() + d);\r\n        return fecha.toLocaleDateString();\r\n      });\r\n  }\r\n\r\n  function setLeyendas() {}\r\n\r\n  function setPendientes() {\r\n    var ancho = 150;\r\n    var offset = 100;\r\n    var xIni = cajaGrafica.inner.width / 2 - ancho / 2 + offset;\r\n    var xFin = cajaGrafica.inner.width / 2 + ancho / 2 + offset;\r\n    gNoticias.attr(\"stroke\", \"#efefef\");\r\n    console.log(periodos[10]);\r\n    var gs = gNoticias.selectAll(\"g\").data(periodos).enter().insert(\"g\");\r\n    //var gs = gNoticias.selectAll(\"g\").data([periodos[10]]).enter().insert(\"g\");\r\n\r\n    gs.insert(\"path\")\r\n      .attr(\"class\", \"guia\")\r\n      .attr(\"d\", function (d) {\r\n        return (\r\n          \"M\" +\r\n          xIni +\r\n          \",\" +\r\n          escalaEjes(d.dias[0]) +\r\n          \"L\" +\r\n          xFin +\r\n          \",\" +\r\n          escalaEjes(d.dias[1])\r\n        );\r\n      })\r\n      .attr(\"stroke\", \"transparent\");\r\n\r\n    gs.insert(\"path\")\r\n      .attr(\"class\", \"periodo\")\r\n      .attr(\"d\", function (d) {\r\n        return (\r\n          \"M\" +\r\n          xIni +\r\n          \",\" +\r\n          escalaEjes(d.dias[0]) +\r\n          \"L\" +\r\n          xFin +\r\n          \",\" +\r\n          escalaEjes(d.dias[1])\r\n        );\r\n      });\r\n\r\n    gs.insert(\"circle\")\r\n      .attr(\"class\", \"destino\")\r\n      .attr(\"fill\", \"#ababab\")\r\n      .attr(\"r\", 4)\r\n      .attr(\"cx\", xIni)\r\n      .attr(\"cy\", function (d) {\r\n        return escalaEjes(d.dias[0]);\r\n      });\r\n  }\r\n\r\n  function setFlujos() {\r\n    var grupos = gFlujos\r\n      //.style(\"mix-blend-mode\", \"multiply\")\r\n      .selectAll(\"g.flujo\")\r\n      .data(flujos)\r\n      .enter()\r\n      .insert(\"g\")\r\n      .attr(\"class\", \"flujo\");\r\n\r\n    grupos\r\n      .append(\"path\")\r\n      .attr(\"class\", \"flujo visible\")\r\n      .attr(\"d\", function (d) {\r\n        return linea(d.puntos);\r\n      })\r\n      .attr(\"shape-rendering\", \"geometricPrecision\")\r\n      .style(\"stroke-width\", 0)\r\n      .style(\"stroke-style\", \"solid\")\r\n      .style(\"stroke-linecap\", \"round\")\r\n      .style(\"stroke\", function (d) {\r\n        return d.origen.color;\r\n      })\r\n      //.attr(\"opacity\", 0.8)\r\n      .attr(\"fill\", \"none\")\r\n      .style(\"stroke-width\", 1);\r\n  }\r\n\r\n  function setFlujosViejo() {\r\n    var grupos = gFlujos\r\n      .style(\"mix-blend-mode\", \"multiply\")\r\n      .selectAll(\"g.flujo\")\r\n      .data(flujos)\r\n      .enter()\r\n      .insert(\"g\")\r\n      .attr(\"class\", \"flujo\");\r\n\r\n    grupos\r\n      .append(\"path\")\r\n      .attr(\"class\", \"invisible\")\r\n      .attr(\"d\", function (d) {\r\n        return linea(d.puntos);\r\n      })\r\n      .attr(\"shape-rendering\", \"geometricPrecision\")\r\n      .attr(\"stroke\", \"#ffffff\")\r\n      .style(\"stroke-width\", \"20px\")\r\n      .style(\"stroke-style\", \"solid\")\r\n      .attr(\"opacity\", 0)\r\n      .attr(\"fill\", \"none\")\r\n      .on(\"click\", actualizaFlujos)\r\n      .each(function (d) {\r\n        var opciones = tooltips.getOpciones();\r\n        var contenido = \"\";\r\n        var aux = [];\r\n        var primeraenviada = 0;\r\n        var primerarecibida = 0;\r\n        var ultimaenviada = 0;\r\n        var ultimarecibida = 0;\r\n        var opcionesFecha = {\r\n          year: \"numeric\",\r\n          month: \"long\",\r\n          day: \"numeric\",\r\n        };\r\n        contenido +=\r\n          '<h2><span style=\"color:' +\r\n          d.origen.color +\r\n          ';\">' +\r\n          d.origen.nombre +\r\n          \", \" +\r\n          d.origen.nombrepais +\r\n          '</span> - <span style=\"color:' +\r\n          d.destino.color +\r\n          ';\">' +\r\n          d.destino.nombre +\r\n          \", \" +\r\n          d.destino.nombrepais +\r\n          \"</span></h2>\";\r\n\r\n        contenido +=\r\n          \"<p>Se encontraron <strong>\" +\r\n          d.noticias.length +\r\n          \" noticias</strong> en este flujo</p>\";\r\n\r\n        aux = _.map(d.noticias, function (n) {\r\n          return n.origen.fecha;\r\n        });\r\n        primeraenviada = _.min(aux);\r\n        ultimaenviada = _.max(aux);\r\n\r\n        aux = _.map(d.noticias, function (n) {\r\n          return n.destino.fecha;\r\n        });\r\n        primerarecibida = _.min(aux);\r\n        ultimarecibida = _.max(aux);\r\n\r\n        contenido +=\r\n          \"<p>La primera noticia se envió el <strong>\" +\r\n          primeraenviada.toLocaleDateString(\"sp\", opcionesFecha) +\r\n          \"</strong> y se recibió el <strong>\" +\r\n          primerarecibida.toLocaleDateString(\"sp\", opcionesFecha) +\r\n          \"</strong></p>\";\r\n\r\n        contenido +=\r\n          \"<p>La última noticia se envió el <strong>\" +\r\n          ultimaenviada.toLocaleDateString(\"sp\", opcionesFecha) +\r\n          \"</strong> y se recibió el <strong>\" +\r\n          ultimarecibida.toLocaleDateString(\"sp\", opcionesFecha) +\r\n          \"</strong></p>\";\r\n        aux = _.map(d.noticias, \"dias\");\r\n        aux = Math.round(_.mean(aux));\r\n        contenido +=\r\n          \"<p>En promedio, las noticias tardaron <strong>\" +\r\n          aux +\r\n          \" días</strong> en llegar a su destino</p>\";\r\n        d.contenido = contenido;\r\n        opciones.content = $(contenido);\r\n        $(this).tooltipster(opciones);\r\n      });\r\n\r\n    grupos\r\n      .append(\"path\")\r\n      .attr(\"class\", \"flujo visible\")\r\n      .attr(\"d\", function (d) {\r\n        return linea(d.puntos);\r\n      })\r\n      .attr(\"shape-rendering\", \"geometricPrecision\")\r\n      .style(\"stroke-width\", 0)\r\n      .style(\"stroke-style\", \"solid\")\r\n      .style(\"stroke-linecap\", \"round\")\r\n      .style(\"stroke\", function (d) {\r\n        //return \"url(#gradiente-\" + d.origen.slug + \"-\" + d.destino.slug + \")\";\r\n        return d.origen.color;\r\n      })\r\n      .attr(\"opacity\", 0.8)\r\n      .attr(\"fill\", \"none\")\r\n      .each(function (d) {\r\n        d.largo = d3.select(this).node().getTotalLength();\r\n      })\r\n      .attr(\"stroke-dasharray\", function (d) {\r\n        return d.largo + \" \" + d.largo;\r\n      })\r\n      .attr(\"stroke-dashoffset\", function (d) {\r\n        return d.largo;\r\n      })\r\n      .transition()\r\n      .duration(1500)\r\n      .ease(d3.easeLinear)\r\n      .attr(\"stroke-dashoffset\", 0)\r\n      .style(\"stroke-width\", function (d) {\r\n        return escala(d.noticias.length) + \"px\";\r\n      });\r\n  }\r\n\r\n  function setResumen() {\r\n    var diferencia = 100;\r\n    var offset = diferencia / 2;\r\n    var ancho = caja.content.width - diferencia;\r\n    var inter = 0;\r\n    var posX = 0;\r\n    inter = ancho / origenes.length;\r\n    posX = offset + inter / 2;\r\n\r\n    var fecha = escalaFechas(0);\r\n    _.each(origenes, function (d) {\r\n      d.noticiasOrigen = _.filter(d.noticias, function (n) {\r\n        return n.origen.fecha <= fecha;\r\n      });\r\n      d.noticiasDestino = _.filter(d.noticias, function (n) {\r\n        return n.destino.fecha <= fecha;\r\n      });\r\n    });\r\n\r\n    svgResumen\r\n      .selectAll(\"path.enviadas\")\r\n      .data(origenes)\r\n      .enter()\r\n      .insert(\"path\")\r\n      .attr(\"class\", \"enviada\")\r\n      .attr(\"fill\", function (d) {\r\n        return rebajaColor(d.color);\r\n      })\r\n      .attr(\"d\", function (d) {\r\n        var s = simbolo.size(escalaResumen(d.noticiasOrigen.length));\r\n        //var s = simbolo.size(0);\r\n        return s();\r\n      })\r\n      .attr(\"transform\", function (d, i) {\r\n        return \"translate(\" + (posX + i * inter) + \",160)\";\r\n      });\r\n\r\n    svgResumen\r\n      .selectAll(\"path.recibida\")\r\n      .data(origenes)\r\n      .enter()\r\n      .insert(\"path\")\r\n      .attr(\"class\", \"recibida\")\r\n      .attr(\"fill\", function (d) {\r\n        return d.color;\r\n      })\r\n      .attr(\"d\", function (d) {\r\n        var s = simbolo.size(escalaResumen(d.noticiasDestino.length));\r\n        //var s = simbolo.size(0);\r\n        return s();\r\n      })\r\n      .attr(\"transform\", function (d, i) {\r\n        return \"translate(\" + (posX + i * inter) + \",160)\";\r\n      });\r\n\r\n    svgResumen\r\n      .selectAll(\"text.nombre\")\r\n      .data(origenes)\r\n      .enter()\r\n      .insert(\"text\")\r\n      .attr(\"class\", \"nombre\")\r\n      .attr(\"font-size\", 20)\r\n      .attr(\"fill\", \"#ababab\")\r\n      .attr(\"stroke-width\", 1)\r\n      .attr(\"text-anchor\", \"middle\")\r\n      .attr(\"x\", function (d, i) {\r\n        return posX + i * inter;\r\n      })\r\n      .attr(\"y\", 290)\r\n      .text(function (d) {\r\n        return d.nombrepais;\r\n      });\r\n\r\n    svgResumen\r\n      .selectAll(\"text.noticiase\")\r\n      .data(origenes)\r\n      .enter()\r\n      .insert(\"text\")\r\n      .attr(\"class\", \"noticiase\")\r\n      .attr(\"font-size\", 14)\r\n      .attr(\"fill\", \"#ababab\")\r\n      .attr(\"stroke-width\", 1)\r\n      .attr(\"text-anchor\", \"middle\")\r\n      .attr(\"x\", function (d, i) {\r\n        return posX + i * inter;\r\n      })\r\n      .attr(\"y\", 310)\r\n      .text(function (d) {\r\n        return d.noticiasOrigen.length + \" enviadas\";\r\n      });\r\n\r\n    svgResumen\r\n      .selectAll(\"text.noticiasr\")\r\n      .data(origenes)\r\n      .enter()\r\n      .insert(\"text\")\r\n      .attr(\"class\", \"noticiasr\")\r\n      .attr(\"font-size\", 14)\r\n      .attr(\"fill\", \"#ababab\")\r\n      .attr(\"stroke-width\", 1)\r\n      .attr(\"text-anchor\", \"middle\")\r\n      .attr(\"x\", function (d, i) {\r\n        return posX + i * inter;\r\n      })\r\n      .attr(\"y\", 328)\r\n      .text(function (d) {\r\n        return d.noticiasDestino.length + \" recibidas\";\r\n      });\r\n\r\n    svgResumen\r\n      .append(\"text\")\r\n      .text(\"Noticias por país\")\r\n      .attr(\"fill\", \"#ababab\")\r\n      .attr(\"stroke-width\", 1)\r\n      .attr(\"text-anchor\", \"middle\")\r\n      .attr(\"dominant-baseline\", \"hanging\")\r\n      .attr(\"x\", 800)\r\n      .attr(\"y\", 0)\r\n      .attr(\"font-size\", 30);\r\n  }\r\n\r\n  function setSlider() {\r\n    var fechasOrigen = _.map(noticias, function (d) {\r\n      return d.origen.fecha;\r\n    });\r\n    var fechasDestino = _.map(noticias, function (d) {\r\n      return d.destino.fecha;\r\n    });\r\n    var fechaIni = _.clone(_.min(fechasOrigen));\r\n    var fechaFin = _.clone(_.max(fechasDestino));\r\n    fechaIni = new Date(fechaIni.setTime(fechaIni.getTime() - 1 * 86400000));\r\n    fechaFin = new Date(\r\n      fechaFin.setTime(fechaFin.getTime() + 2 * 86400000 - 1)\r\n    );\r\n    escalaFechas.domain([0, 530]).range([fechaIni, fechaFin]);\r\n\r\n    fechaSlider = svgSlider\r\n      .append(\"text\")\r\n      .text(\"Fecha: \" + fechaIni.toLocaleDateString())\r\n      .attr(\"x\", 0)\r\n      .attr(\"y\", 0)\r\n      .attr(\"fill\", \"#ababab\")\r\n      .attr(\"font-size\", 20)\r\n      .attr(\"stroke-width\", 1)\r\n      .attr(\"dominant-baseline\", \"hanging\");\r\n\r\n    svgSlider\r\n      .append(\"rect\")\r\n      .attr(\"fill\", \"#efefef\")\r\n      .attr(\"height\", 50)\r\n      .attr(\"width\", 580)\r\n      .attr(\"x\", 0)\r\n      .attr(\"y\", 30);\r\n\r\n    controlSlider = svgSlider\r\n      .append(\"rect\")\r\n      .attr(\"fill\", \"#ababab\")\r\n      .attr(\"height\", 50)\r\n      .attr(\"width\", 50)\r\n      .attr(\"x\", 0)\r\n      .attr(\"y\", 30)\r\n      .call(drag);\r\n  }\r\n\r\n  function main() {\r\n    //tooltips.generaTooltips(gFlujos.selectAll(\"path\"));\r\n    el.removeClass(\"espera\");\r\n    intervalo = d3.timer(mueveSlider);\r\n  }\r\n\r\n  function zoomed() {\r\n    gPaises.style(\"stroke-width\", 1 / d3.event.transform.k + \"px\");\r\n    /*\r\n    gFlujos\r\n      .selectAll(\"path.invisible\")\r\n      .style(\"stroke-width\", 20 / d3.event.transform.k + \"px\");*/\r\n    gFlujos.selectAll(\"path.visible\").style(\"stroke-width\", function (d) {\r\n      return 1 / d3.event.transform.k + \"px\";\r\n    });\r\n    gPaises.attr(\"transform\", d3.event.transform);\r\n    gFlujos.attr(\"transform\", d3.event.transform);\r\n    /*\r\n    gFlujos.selectAll(\"path.invisible\").each(function(d) {\r\n      $(this).tooltipster(\"content\", $(d.contenido));\r\n    });\r\n    */\r\n  }\r\n\r\n  function actualizaPais(d) {\r\n    var path = d3.select(this);\r\n    d.activo = !d.activo;\r\n    path\r\n      .transition()\r\n      .duration(200)\r\n      .attr(\"fill\", function (d) {\r\n        return d.activo ? d.color : rebajaColor(d.color);\r\n      });\r\n  }\r\n\r\n  function actualizaMapaViejo(d) {\r\n    var path = d3.select(this);\r\n    var fs = null;\r\n    var fsa = null;\r\n    var fsp = null;\r\n    var claves = [];\r\n    var ids = [];\r\n    d.activo = !d.activo;\r\n    path\r\n      .transition()\r\n      .duration(400)\r\n      .attr(\"fill\", function (d) {\r\n        return d.activo ? d.color : rebajaColor(d.color);\r\n      });\r\n    fs = _.filter(flujos, function (f) {\r\n      return f.origen.pais === d.id || f.destino.pais === d.id;\r\n    });\r\n    _.each(fs, function (f) {\r\n      claves.push(f.clave);\r\n      if (f.origen.pais === d.id) {\r\n        f.origen.activo = d.activo;\r\n      }\r\n      if (f.destino.pais === d.id) {\r\n        f.destino.activo = d.activo;\r\n      }\r\n    });\r\n\r\n    gFlujos\r\n      .selectAll(\"path.visible\")\r\n      .filter(function (df) {\r\n        return claves.indexOf(df.clave) >= 0;\r\n      })\r\n      .transition()\r\n      .duration(400)\r\n      .attr(\"opacity\", function (df) {\r\n        return df.activo && df.origen.activo && df.destino.activo ? 0.8 : 0.2;\r\n      });\r\n\r\n    fsa = _.filter(fs, function (f) {\r\n      return f.activo;\r\n    });\r\n\r\n    _.each(fsa, function (fa) {\r\n      if (fa.origen.activo) {\r\n        ids.push(fa.origen.pais);\r\n      }\r\n      if (fa.destino.activo) {\r\n        ids.push(fa.destino.pais);\r\n      }\r\n    });\r\n    ids = _.uniq(ids);\r\n\r\n    var fsp = _.filter(flujos, function (f) {\r\n      return (\r\n        f.activo &&\r\n        f.destino.activo &&\r\n        f.origen.activo &&\r\n        (ids.indexOf(f.origen.pais) >= 0 || ids.indexOf(f.destino.pais) >= 0)\r\n      );\r\n    });\r\n\r\n    gPaises\r\n      .selectAll(\"path.activo\")\r\n      .filter(function (dp) {\r\n        return dp.activo && ids.indexOf(dp.id) >= 0;\r\n      })\r\n      .transition()\r\n      .duration(400)\r\n      .attr(\"fill\", function (dp) {\r\n        var entrantes = _.filter(fsp, function (fa) {\r\n          return fa.destino.pais == dp.id;\r\n        });\r\n        var salientes = _.filter(fsp, function (fa) {\r\n          return fa.origen.pais == dp.id;\r\n        });\r\n        return dp.activo && (entrantes.length > 0 || salientes.length > 0)\r\n          ? dp.color\r\n          : rebajaColor(dp.color);\r\n      });\r\n  }\r\n\r\n  function actualizaFlujos(d) {\r\n    var g = d3.select(this.parentNode);\r\n    var path = g.select(\"path.flujo.visible\");\r\n    var ps = null;\r\n    var fs = null;\r\n    d.activo = !d.activo;\r\n\r\n    path\r\n      .transition()\r\n      .duration(400)\r\n      .attr(\"opacity\", function (df) {\r\n        //return df.activo && df.origen.activo && df.destino.activo ? 1 : 0.2;\r\n        return df.activo ? 0.8 : 0.2;\r\n      });\r\n\r\n    fs = _.filter(flujos, function (f) {\r\n      return (\r\n        f.activo &&\r\n        (f.origen.pais === d.origen.pais ||\r\n          f.destino.pais === d.origen.pais ||\r\n          f.origen.pais === d.destino.pais ||\r\n          f.destino.pais === d.destino.pais)\r\n      );\r\n    });\r\n\r\n    ps = gPaises\r\n      .selectAll(\"path.activo\")\r\n      .filter(function (dp) {\r\n        return dp.id === d.origen.pais || dp.id === d.destino.pais;\r\n      })\r\n      .transition()\r\n      .duration(400)\r\n      .attr(\"fill\", function (dp) {\r\n        var entrantes = _.filter(fs, function (f) {\r\n          return f.destino.pais === dp.id;\r\n        });\r\n        var salientes = _.filter(fs, function (f) {\r\n          return f.origen.pais === dp.id;\r\n        });\r\n        if (dp.activo === false) {\r\n          if (entrantes.length > 0 || salientes.length > 0) {\r\n            dp.activo = true;\r\n          }\r\n        }\r\n        return dp.activo && (entrantes.length > 0 || salientes.length > 0)\r\n          ? dp.color\r\n          : rebajaColor(dp.color);\r\n      });\r\n  }\r\n\r\n  function rebajaColor(color) {\r\n    //var n = d3.hsl(color.h, color.s - 0.3, 0.8);\r\n    var n = d3.hsl(color.h, color.s - 0.3, 0.9);\r\n    return n;\r\n  }\r\n\r\n  function dragstarted(d) {\r\n    d3.select(this).attr(\"stroke\", \"black\");\r\n    //raise();\r\n  }\r\n\r\n  function dragged(d) {\r\n    var control = d3.select(this);\r\n    var x = +control.attr(\"x\");\r\n    var nX = Math.round(x + d3.event.dx);\r\n    if (nX < 0) {\r\n      nX = 0;\r\n    }\r\n    if (nX > 530) {\r\n      nX = 530;\r\n    }\r\n    control.attr(\"x\", nX);\r\n    actualizaGraficas(nX);\r\n  }\r\n\r\n  function dragended(d) {\r\n    d3.select(this).attr(\"stroke\", null);\r\n  }\r\n\r\n  function actualizaFechaSlider(fecha) {\r\n    fechaSlider.text(\"Fecha: \" + fecha.toLocaleDateString());\r\n  }\r\n\r\n  function actualizaResumen(fecha) {\r\n    _.each(origenes, function (d) {\r\n      d.noticiasOrigen = _.filter(d.noticias, function (n) {\r\n        return n.origen.fecha <= fecha;\r\n      });\r\n      d.noticiasDestino = _.filter(d.noticias, function (n) {\r\n        return n.destino.fecha <= fecha;\r\n      });\r\n    });\r\n\r\n    svgResumen\r\n      .selectAll(\"path.enviada\")\r\n      .transition()\r\n      .duration(50)\r\n      .attr(\"d\", function (d) {\r\n        var s = simbolo.size(escalaResumen(d.noticiasOrigen.length));\r\n        return s();\r\n      });\r\n\r\n    svgResumen\r\n      .selectAll(\"path.recibida\")\r\n      .transition()\r\n      .duration(50)\r\n      .attr(\"d\", function (d) {\r\n        var s = simbolo.size(escalaResumen(d.noticiasDestino.length));\r\n        return s();\r\n      });\r\n\r\n    svgResumen.selectAll(\"text.noticiase\").text(function (d) {\r\n      return d.noticiasOrigen.length + \" enviadas\";\r\n    });\r\n\r\n    svgResumen.selectAll(\"text.noticiasr\").text(function (d) {\r\n      return d.noticiasDestino.length + \" recibidas\";\r\n    });\r\n  }\r\n\r\n  function mueveSlider() {\r\n    var x = +controlSlider.attr(\"x\") + 2;\r\n    if (x >= 530) {\r\n      x = 530;\r\n    }\r\n    controlSlider.attr(\"x\", x);\r\n    actualizaGraficas(x);\r\n    if (x == 530) {\r\n      intervalo.stop();\r\n    }\r\n  }\r\n\r\n  function actualizaPendientes(x) {\r\n    var fecha = escalaFechas(x);\r\n    var grupos = gNoticias.selectAll(\"g\");\r\n    grupos.each(function (d, i) {\r\n      var grupo = d3.select(this);\r\n      var guia = grupo.select(\"path.guia\");\r\n      //var path = grupo.select(\"path.periodo\");\r\n      var circle = grupo.select(\"circle.destino\");\r\n      var g = null;\r\n      var largo = guia.node().getTotalLength();\r\n      if (fecha <= d.origen) {\r\n        g = guia.node().getPointAtLength(0);\r\n      }\r\n      if (d.destinoPadding <= fecha) {\r\n        g = guia.node().getPointAtLength(largo);\r\n      } else {\r\n        var total = d.destinoPadding.getTime() - d.origen.getTime();\r\n        var parcial = fecha.getTime() - d.origen.getTime();\r\n        var pct = (parcial * 100) / total;\r\n        var g = guia.node().getPointAtLength((pct * largo) / 100);\r\n      }\r\n      circle.attr(\"cx\", g.x).attr(\"cy\", g.y);\r\n    });\r\n  }\r\n\r\n  function actualizaGraficas(x) {\r\n    var fecha = escalaFechas(x);\r\n    actualizaFechaSlider(fecha);\r\n    actualizaResumen(fecha);\r\n    actualizaPendientes(x);\r\n  }\r\n\r\n  setup();\r\n};\r\n\r\nvar NubeDePalabrasCombinadas = function (el, i) {\r\n  var debug = false;\r\n\r\n  var alturaControles = 40;\r\n  var frame = new Frame();\r\n\r\n  var marco = frame.getFrame();\r\n  var margin = frame.getMargin();\r\n  var principal = frame.getMain();\r\n\r\n  var contenedor = null;\r\n  var svg = null;\r\n  var gPalabras = null;\r\n  var gControles = null;\r\n\r\n  var layout = null;\r\n\r\n  var datos = null;\r\n  var total = 180;\r\n  //total = 96;\r\n  var numeroDeCategorias = 0;\r\n  var min = 0;\r\n  var max = 0;\r\n  var paddingControl = 100;\r\n\r\n  function setup() {\r\n    contenedor = d3.select(el[0]);\r\n    var flag = el.data(\"visualizacion\") || false;\r\n    if (flag === false) {\r\n      el.data(\"visualizacion\", true);\r\n      contenedor.selectAll(\"svg\").remove();\r\n      svg = contenedor\r\n        .append(\"svg\")\r\n        .attr(\"preserveAspectRatio\", \"xMidYMid\")\r\n        .attr(\r\n          \"viewBox\",\r\n          \"0 0 \" + marco.width + \" \" + (marco.height + alturaControles)\r\n        );\r\n\r\n      el.attr(\"data-setup\", true);\r\n\r\n      if (debug === true) {\r\n        svg\r\n          .attr(\"id\", el.data(\"tipo-visualizacion\") + \"-\" + i)\r\n          .append(\"rect\")\r\n          .attr(\"fill\", \"yellow\")\r\n          .attr(\"opacity\", 0.5)\r\n          .attr(\"x\", 0)\r\n          .attr(\"y\", 0)\r\n          .attr(\"width\", marco.width)\r\n          .attr(\"height\", marco.height + alturaControles);\r\n      }\r\n\r\n      svg = svg\r\n        .append(\"g\")\r\n        .attr(\"transform\", \"translate(\" + margin.left + \",\" + margin.top + \")\");\r\n\r\n      if (debug === true) {\r\n        svg\r\n          .attr(\"class\", \"svg\")\r\n          .append(\"rect\")\r\n          .attr(\"width\", principal.width)\r\n          .attr(\"height\", principal.height + alturaControles)\r\n          .attr(\"fill\", \"blue\")\r\n          .attr(\"opacity\", 0.5);\r\n      }\r\n\r\n      gPalabras = svg.append(\"g\");\r\n      gControles = svg\r\n        .append(\"g\")\r\n        .attr(\"transform\", \"translate(0,\" + principal.height + \")\");\r\n\r\n      if (debug === true) {\r\n        gPalabras.attr(\"id\", \"gPalabras-\" + i);\r\n        gControles.attr(\"id\", \"gControles-\" + i);\r\n      }\r\n\r\n      var palabrasURL = \"csv/\" + el.data(\"palabras\") + \".csv\";\r\n      var categoriasURL = \"csv/\" + el.data(\"categorias\") + \".csv\";\r\n      var promesas = [];\r\n      var colores = d3.interpolateRainbow;\r\n      promesas.push(\r\n        d3.csv(palabrasURL, function (d, i) {\r\n          var color = colores(i / 10 + 0.5);\r\n          return {\r\n            palabra: d.palabra.replace(/_/g, \" \"),\r\n            categoria: d.categoria,\r\n            valor: +d.valor,\r\n            estilo: {\r\n              color: color,\r\n              tamanio: 0,\r\n            },\r\n            tooltip: {\r\n              color: color,\r\n              contenido: null,\r\n            },\r\n          };\r\n        })\r\n      );\r\n      promesas.push(d3.csv(categoriasURL));\r\n\r\n      Promise.all(promesas).then(function (values) {\r\n        var palabras = values[0];\r\n        var categorias = values[1];\r\n        var palabrasFiltradas = null;\r\n        var extremos = [];\r\n        numeroDeCategorias = categorias.length;\r\n        datos = [];\r\n        _.each(categorias, function (categoria) {\r\n          var etiqueta = categoria.etiqueta;\r\n          var singular = categoria.singular;\r\n          var clave = categoria.categoria;\r\n          palabrasFiltradas = _.filter(palabras, { categoria: clave });\r\n          palabrasFiltradas = _.orderBy(\r\n            palabrasFiltradas,\r\n            [\"valor\", \"palabra\"],\r\n            [\"desc\", \"desc\"]\r\n          );\r\n          palabrasFiltradas = palabrasFiltradas.splice(0, total);\r\n          extremos.push(_.minBy(palabrasFiltradas, \"valor\"));\r\n          extremos.push(_.maxBy(palabrasFiltradas, \"valor\"));\r\n          datos.push({\r\n            etiqueta: etiqueta,\r\n            singular: singular,\r\n            categoria: clave,\r\n            flagMostrar: true,\r\n            palabras: palabrasFiltradas,\r\n          });\r\n        });\r\n        extremos = _.map(extremos, \"valor\");\r\n        min = _.min(extremos);\r\n        max = _.max(extremos);\r\n        setControles();\r\n        setLayout();\r\n        main();\r\n      });\r\n    }\r\n  }\r\n\r\n  function setControles() {\r\n    if (debug === true) {\r\n      gControles\r\n        .append(\"rect\")\r\n        .attr(\"width\", principal.width)\r\n        .attr(\"height\", alturaControles)\r\n        .attr(\"fill\", \"red\")\r\n        .attr(\"opacity\", 0.5);\r\n    }\r\n\r\n    gControles\r\n      .append(\"text\")\r\n      .style(\"font-family\", \"Roboto\")\r\n      .attr(\"text-anchor\", \"start\")\r\n      .style(\"fill\", \"#808080\")\r\n      .style(\"font-size\", \"24px\")\r\n      .attr(\"dy\", \"1.5em\")\r\n      .text(\"Categorías:\");\r\n\r\n    var gCategorias = gControles\r\n      .append(\"g\")\r\n      .attr(\"transform\", \"translate(200,0)\");\r\n\r\n    var grupos = gCategorias\r\n      .selectAll(\"g\")\r\n      .data(datos)\r\n      .enter()\r\n      .append(\"g\")\r\n      .on(\"click\", function (d) {\r\n        d.flagMostrar = !d.flagMostrar;\r\n        d3.select(this)\r\n          .select(\"text\")\r\n          .text(function (d) {\r\n            var caja = \"☑\";\r\n            if (d.flagMostrar === false) {\r\n              caja = \"☐\";\r\n            }\r\n            return d.etiqueta + \" \" + caja;\r\n          });\r\n        setNube();\r\n      });\r\n\r\n    grupos\r\n      .append(\"text\")\r\n      .attr(\"class\", \"pointer\")\r\n      .style(\"font-family\", \"Roboto\")\r\n      .attr(\"text-anchor\", \"start\")\r\n      .style(\"fill\", \"#808080\")\r\n      .style(\"font-size\", \"24px\")\r\n      .attr(\"dy\", \"1.5em\")\r\n      .text(function (d) {\r\n        return d.etiqueta + \" ☑\";\r\n        //☐ ascii ballot box\r\n      })\r\n      .each(function (d) {\r\n        d.caja = this.getBBox();\r\n      });\r\n\r\n    var arregloDeAnchuras = _.map(datos, function (d) {\r\n      return d.caja.width;\r\n    });\r\n    arregloDeAnchuras.unshift(0);\r\n\r\n    grupos.attr(\"transform\", function (d, i) {\r\n      var arregloAnchurasPrevias = arregloDeAnchuras.slice(0, i + 1);\r\n      var offset = _.sum(arregloAnchurasPrevias) + i * paddingControl;\r\n      return \"translate(\" + offset + \",0)\";\r\n    });\r\n  }\r\n\r\n  function setLayout() {\r\n    layout = d3.layout\r\n      .cloud()\r\n      .size([principal.width, principal.height])\r\n      //.words(palabrasFiltradas)\r\n      .text(function (d) {\r\n        return d.palabra;\r\n      })\r\n      .rotate(function () {\r\n        return (~~(Math.random() * 5) - 2) * 45;\r\n      })\r\n      .fontSize(function (d) {\r\n        return d.estilo.tamanio;\r\n      })\r\n      .spiral(\"rectangular\")\r\n      .font(\"Roboto\")\r\n      .on(\"end\", setPalabras);\r\n    //.start();\r\n  }\r\n\r\n  function setNube() {\r\n    //En algún lado se me pierden las paabras contra categorías\r\n    var palabrasFiltradas = null;\r\n    var datosFiltrados = null;\r\n    var palabrasPorCategoria = 0;\r\n    var categoriasAMostrar = 0;\r\n    var objetoDeCategorias = {};\r\n\r\n    datosFiltrados = _.filter(datos, \"flagMostrar\");\r\n\r\n    _.each(datosFiltrados, function (categoria) {\r\n      objetoDeCategorias[categoria.categoria] = categoria.singular;\r\n    });\r\n    categoriasAMostrar = datosFiltrados.length;\r\n\r\n    if (categoriasAMostrar > 0) {\r\n      palabrasPorCategoria = Math.ceil(total / categoriasAMostrar);\r\n    }\r\n\r\n    palabrasFiltradas = _.map(datosFiltrados, function (d) {\r\n      var aux = _.clone(d.palabras);\r\n      return aux.splice(0, palabrasPorCategoria);\r\n    });\r\n    palabrasFiltradas = _.flatten(palabrasFiltradas);\r\n\r\n    var escala = d3.scaleSymlog().range([6, 50]).domain([min, max]);\r\n    window.escala = escala;\r\n\r\n    _.each(palabrasFiltradas, function (d) {\r\n      d.estilo.tamanio = +escala(d.valor);\r\n    });\r\n\r\n    layout\r\n      .stop()\r\n      .words(palabrasFiltradas) //Se necesitan actualizar las palabrasFiltradas ANTES de llamar a setNube\r\n      .start();\r\n  }\r\n\r\n  function setPalabras(datos) {\r\n    var t = d3\r\n      .transition(\"nubedepalabras-\" + i)\r\n      .duration(200)\r\n      .ease(d3.easeCubicIn);\r\n\r\n    var palabras = gPalabras.selectAll(\"text\").data(datos, function (d) {\r\n      return d.palabra.toLowerCase();\r\n    });\r\n\r\n    palabras\r\n      .transition(t)\r\n      .attr(\"transform\", function (d) {\r\n        return (\r\n          \"translate(\" +\r\n          [d.x + principal.width / 2, d.y + principal.height / 2] +\r\n          \")rotate(\" +\r\n          d.rotate +\r\n          \")\"\r\n        );\r\n      })\r\n      .style(\"font-size\", function (d) {\r\n        return d.estilo.tamanio + \"px\";\r\n      });\r\n\r\n    palabras\r\n      .enter()\r\n      .append(\"text\")\r\n      .style(\"font-family\", \"Roboto\")\r\n      .attr(\"text-anchor\", \"middle\")\r\n      .style(\"fill\", function (d) {\r\n        return d.estilo.color;\r\n      })\r\n      .text(function (d) {\r\n        return d.palabra;\r\n      })\r\n      .attr(\"transform\", function (d) {\r\n        return (\r\n          \"translate(\" +\r\n          [d.x + principal.width / 2, d.y + principal.height / 2] +\r\n          \")rotate(0)\"\r\n        );\r\n      })\r\n      .style(\"font-size\", 0 + \"px\")\r\n      .transition(t)\r\n      .attr(\"transform\", function (d) {\r\n        return (\r\n          \"translate(\" +\r\n          [d.x + principal.width / 2, d.y + principal.height / 2] +\r\n          \")rotate(\" +\r\n          d.rotate +\r\n          \")\"\r\n        );\r\n      })\r\n      .style(\"font-size\", function (d) {\r\n        return d.estilo.tamanio + \"px\";\r\n      });\r\n\r\n    palabras.exit().transition(t).style(\"font-size\", \"0px\").remove();\r\n  }\r\n\r\n  function main() {\r\n    //tooltips.generaTooltips(gPalabras.selectAll(\"text\"));\r\n    el.removeClass(\"espera\");\r\n    setNube();\r\n  }\r\n\r\n  setup();\r\n};\r\n\r\n/*\r\nhttps://hackernoon.com/understanding-async-await-in-javascript-1d81bb079b2c\r\nhttps://hackernoon.com/understanding-promises-in-javascript-13d99df067c1\r\nhttps://medium.freecodecamp.org/how-to-make-a-promise-out-of-a-callback-function-in-javascript-d8ec35d1f981\r\n*/\r\n\r\nvar NubeDePalabras = function (el, i) {\r\n  var debug = false;\r\n  var frame = new Frame();\r\n\r\n  var marco = frame.getFrame();\r\n  var margin = frame.getMargin();\r\n  var principal = frame.getMain();\r\n\r\n  var contenedor = null;\r\n  var svg = null;\r\n  var gPalabras = null;\r\n\r\n  var datos = null;\r\n\r\n  function setup() {\r\n    contenedor = d3.select(el[0]);\r\n    var flag = el.data(\"visualizacion\") || false;\r\n    if (flag === false) {\r\n      el.data(\"visualizacion\", true);\r\n      contenedor.selectAll(\"svg\").remove();\r\n      svg = contenedor\r\n        .append(\"svg\")\r\n        .attr(\"preserveAspectRatio\", \"xMidYMid\")\r\n        .attr(\"viewBox\", \"0 0 \" + marco.width + \" \" + marco.height);\r\n\r\n      el.attr(\"data-setup\", true);\r\n\r\n      if (debug === true) {\r\n        svg\r\n          .attr(\"id\", el.data(\"tipo-visualizacion\") + \"-\" + i)\r\n          .append(\"rect\")\r\n          .attr(\"fill\", \"yellow\")\r\n          .attr(\"opacity\", 0.5)\r\n          .attr(\"x\", 0)\r\n          .attr(\"y\", 0)\r\n          .attr(\"width\", marco.width)\r\n          .attr(\"height\", marco.height);\r\n      }\r\n\r\n      svg = svg\r\n        .append(\"g\")\r\n        .attr(\"transform\", \"translate(\" + margin.left + \",\" + margin.top + \")\");\r\n\r\n      if (debug === true) {\r\n        svg\r\n          .attr(\"class\", \"svg\")\r\n          .append(\"rect\")\r\n          .attr(\"width\", principal.width)\r\n          .attr(\"height\", principal.height)\r\n          .attr(\"fill\", \"blue\")\r\n          .attr(\"opacity\", 0.5);\r\n      }\r\n\r\n      gPalabras = svg.append(\"g\");\r\n\r\n      if (debug === true) {\r\n        gPalabras.attr(\"id\", \"gPalabras-\" + i);\r\n      }\r\n\r\n      var palabrasURL = \"csv/\" + el.data(\"palabras\") + \".csv\";\r\n      var archivosCSV = [palabrasURL];\r\n      var promesas = [];\r\n      var colores = d3.schemeCategory10;\r\n      _.each(archivosCSV, function (archivo) {\r\n        promesas.push(\r\n          d3.csv(archivo, function (d, i) {\r\n            return {\r\n              palabra: d.palabra.replace(/_/g, \" \"),\r\n              valor: +d.valor,\r\n              estilo: { color: colores[i % colores.length], tamanio: 0 },\r\n              tooltip: { color: colores[i % colores.length], contenido: null },\r\n            };\r\n          })\r\n        );\r\n      });\r\n\r\n      Promise.all(promesas).then(function (values) {\r\n        datos = values[0];\r\n        datos = _.orderBy(datos, [\"valor\", \"palabra\"], [\"desc\", \"desc\"]);\r\n        datos = datos.splice(0, 150);\r\n        setNube();\r\n      });\r\n    }\r\n  }\r\n\r\n  function setNube() {\r\n    var min = d3.min(datos, function (d) {\r\n      return d.valor;\r\n    });\r\n    var max = d3.max(datos, function (d) {\r\n      return d.valor;\r\n    });\r\n    var escala = d3.scaleLinear().range([20, 120]).domain([min, max]);\r\n    _.each(datos, function (d) {\r\n      var repeticiones = d.valor === 1 ? \"repetición\" : \"repeticiones\";\r\n      d.estilo.tamanio = +escala(d.valor);\r\n      d.tooltip.contenido =\r\n        '<p><em style=\"color:' +\r\n        d.estilo.color +\r\n        ' \">' +\r\n        d.palabra +\r\n        \":</em> \" +\r\n        d.valor +\r\n        \" \" +\r\n        repeticiones +\r\n        \"</p>\";\r\n    });\r\n\r\n    d3.layout\r\n      .cloud()\r\n      .size([principal.width, principal.height])\r\n      .words(datos)\r\n      .text(function (d) {\r\n        return d.palabra;\r\n      })\r\n      .rotate(function () {\r\n        return (~~(Math.random() * 5) - 2) * 30;\r\n      })\r\n      .fontSize(function (d) {\r\n        return d.estilo.tamanio;\r\n      })\r\n      .spiral(\"rectangular\")\r\n      .font(\"Roboto\")\r\n      .on(\"end\", setPalabras)\r\n      .start();\r\n  }\r\n\r\n  /*async*/ function setPalabras(datos) {\r\n    //var promesa = new Promise(function(resolve, reject) {\r\n\r\n    var t = d3\r\n      .transition(\"nubedepalabras-\" + i)\r\n      .duration(400)\r\n      .ease(d3.easeCubicIn);\r\n\r\n    /*await*/ gPalabras\r\n      .selectAll(\"text\")\r\n      .data(datos)\r\n      .enter()\r\n      .append(\"text\")\r\n      .style(\"font-family\", \"Roboto\")\r\n      .attr(\"text-anchor\", \"middle\")\r\n      .style(\"fill\", function (d) {\r\n        return d.estilo.color;\r\n      })\r\n      .attr(\"transform\", function (d) {\r\n        return (\r\n          \"translate(\" +\r\n          [d.x + principal.width / 2, d.y + principal.height / 2] +\r\n          \")rotate(0)\"\r\n        );\r\n      })\r\n      .text(function (d) {\r\n        return d.palabra;\r\n      })\r\n      .style(\"font-size\", 0 + \"px\")\r\n      .transition(t)\r\n      .attr(\"transform\", function (d) {\r\n        return (\r\n          \"translate(\" +\r\n          [d.x + principal.width / 2, d.y + principal.height / 2] +\r\n          \")rotate(\" +\r\n          d.rotate +\r\n          \")\"\r\n        );\r\n      })\r\n      .style(\"font-size\", function (d) {\r\n        return d.estilo.tamanio + \"px\";\r\n      });\r\n    /*.end();*/\r\n    /*await*/ main();\r\n    //});\r\n  }\r\n\r\n  function main() {\r\n    tooltips.generaTooltips(gPalabras.selectAll(\"text\"));\r\n    el.removeClass(\"espera\");\r\n  }\r\n\r\n  setup();\r\n};\r\n\r\n/*\r\nhttps://hackernoon.com/understanding-async-await-in-javascript-1d81bb079b2c\r\nhttps://hackernoon.com/understanding-promises-in-javascript-13d99df067c1\r\nhttps://medium.freecodecamp.org/how-to-make-a-promise-out-of-a-callback-function-in-javascript-d8ec35d1f981\r\n*/\r\n\r\n$(function () {\r\n  var elementos = [];\r\n  var objetos = [];\r\n\r\n  function getGUID() {\r\n    return (\r\n      Date.now().toString(36) + Math.random().toString(36).substr(2, 5)\r\n    ).toUpperCase();\r\n  }\r\n\r\n  function main() {\r\n    elementos = $(\".contenedor-visualizacion\");\r\n    elementos.addClass(\"espera\");\r\n    _.each(elementos, function (el, i) {\r\n      el = $(el);\r\n      var tipo = el.data(\"tipo-visualizacion\");\r\n      getVisualizacion(el, i, tipo);\r\n    });\r\n  }\r\n\r\n  function getVisualizacion(elemento, i, tipo) {\r\n    switch (tipo) {\r\n      case \"nube-de-palabras\":\r\n        new NubeDePalabras(elemento, i);\r\n        break;\r\n      case \"nube-de-palabras-combinadas\":\r\n        new NubeDePalabrasCombinadas(elemento, i);\r\n        break;\r\n      case \"mapa-de-flujos\":\r\n        new MapaDeFlujos(elemento, i);\r\n        break;\r\n      case \"grafo-con-peso\":\r\n        new GrafoConPeso(elemento, i);\r\n        break;\r\n      case \"mapa-de-noticias\":\r\n        new MapaDeNoticias(elemento, i);\r\n        break;\r\n      /*\r\n      case \"nubes-de-palabras\":\r\n        agregaRutas(datos.opciones, rutas);\r\n        elemento.attr(\"data-setup\", true);\r\n        elemento.removeClass(\"espera\");\r\n        var qn = d3.queue();\r\n        _.each(datos.opciones, function(o) {\r\n          var div = $(\"<div>\", {\r\n            id: \"opcion-\" + o.opcion,\r\n            class: \"visualizacion mini espera\"\r\n          }).appendTo(elemento);\r\n          div = $(div);\r\n          qn.defer(NubeDePalabras, div, o, total);\r\n        });\r\n        qn.awaitAll(function(error, arreglo) {\r\n          callback(null, arreglo);\r\n        });\r\n        break;\r\n        */\r\n      default:\r\n        break;\r\n    }\r\n  }\r\n\r\n  main();\r\n\r\n  /*\r\n\r\n  // some url's to resolve\r\n  var urls = [\r\n    \"csv/maine-mexico-localidades.csv\",\r\n    \"csv/maine-mexico-organizaciones.csv\",\r\n    \"csv/maine-mexico-personas.csv\"\r\n  ];\r\n\r\n  // convert each url to a function that returns a promise\r\n  var funcs = urls.map(function(url) {\r\n    return function() {\r\n      return $.ajax(url);\r\n    };\r\n  });\r\n\r\n  // execute Promises in serial\r\n  promiseSerial(funcs).then(main);\r\n*/\r\n});\r\n\r\n//# sourceMappingURL=aplicacion.js.map\r\n","/*\r\nFunciona como el modelo de cajas con box-sizing: border-box\r\nO sea, el ancho y alto INCLUYEN el padding\r\nhttps://developer.mozilla.org/en-US/docs/Learn/CSS/Introduction_to_CSS/Box_model#Advanced_box_manipulation\r\n*/\r\n\r\nvar Box = function (options) {\r\n  options = options || {};\r\n  var content = options.content || {};\r\n  var padding = options.padding || {};\r\n  var margin = options.margin || {};\r\n  var inner = {};\r\n  var outer = {};\r\n  var box = {};\r\n\r\n  if (Number.isInteger(content)) {\r\n    var valor = content;\r\n    content = {};\r\n    content.width = valor;\r\n    content.height = valor;\r\n  } else {\r\n    content.width = content.width || 0;\r\n    content.height = content.height || 0;\r\n  }\r\n\r\n  if (Number.isInteger(padding)) {\r\n    var valor = padding;\r\n    padding = {};\r\n    padding.top = valor;\r\n    padding.right = valor;\r\n    padding.bottom = valor;\r\n    padding.left = valor;\r\n  } else {\r\n    padding.top = padding.top || 0;\r\n    padding.right = padding.right || 0;\r\n    padding.bottom = padding.bottom || 0;\r\n    padding.left = padding.left || 0;\r\n  }\r\n\r\n  if (Number.isInteger(margin)) {\r\n    var valor = margin;\r\n    margin = {};\r\n    margin.top = valor;\r\n    margin.right = valor;\r\n    margin.bottom = valor;\r\n    margin.left = valor;\r\n  } else {\r\n    margin.top = margin.top || 0;\r\n    margin.right = margin.right || 0;\r\n    margin.bottom = margin.bottom || 0;\r\n    margin.left = margin.left || 0;\r\n  }\r\n\r\n  inner.width = content.width + padding.left + padding.right;\r\n  inner.height = content.height + padding.top + padding.bottom;\r\n\r\n  outer.width = inner.width + margin.left + margin.right;\r\n  outer.height = inner.height + margin.top + margin.bottom;\r\n\r\n  box.margin = margin;\r\n  box.padding = padding;\r\n  box.content = content;\r\n  box.inner = inner;\r\n  box.outer = outer;\r\n\r\n  return box;\r\n};\r\n","var clonsola = (function() {\r\n  function log(obj) {\r\n    console.log(_.cloneDeep(obj));\r\n  }\r\n\r\n  function dir(obj) {\r\n    console.dir(_.cloneDeep(obj));\r\n  }\r\n\r\n  function warn(obj) {\r\n    console.warn(_.cloneDeep(obj));\r\n  }\r\n\r\n  function error(obj) {\r\n    console.error(_.cloneDeep(obj));\r\n  }\r\n\r\n  function table(obj) {\r\n    console.table(_.cloneDeep(obj));\r\n  }\r\n\r\n  function clear() {\r\n    console.clear();\r\n  }\r\n\r\n  return {\r\n    log: log,\r\n    dir: dir,\r\n    warn: warn,\r\n    error: error,\r\n    table: table,\r\n    clear: clear\r\n  };\r\n})();\r\n","var promiseSerial = function promiseSerial(funcs) {\r\n  return funcs.reduce(function(promise, func) {\r\n    return promise.then(function(result) {\r\n      return func().then(Array.prototype.concat.bind(result));\r\n    });\r\n  }, Promise.resolve([]));\r\n};\r\n\r\n/*\r\n// some url's to resolve\r\nvar urls = ['/url1', '/url2', '/url3']\r\n\r\n// convert each url to a function that returns a promise\r\nvar funcs = urls.map(function (url) {\r\n  return function () {\r\n    return $.ajax(url);\r\n  };\r\n});\r\n\r\n// execute Promises in serial\r\npromiseSerial(funcs)\r\n  .then(console.log.bind(console))\r\n.catch(console.error.bind(console))\r\n*/\r\n\r\n/*\r\n\"use strict\";\r\n\r\nvar getChuckNorrisFact = function getChuckNorrisFact(url) {\r\n  return new Promise(function (resolve, reject) {\r\n    request.get(url, function (error, response, data) {\r\n      if (error) reject(error);\r\n\r\n      var content = JSON.parse(data);\r\n      var fact = content.value;\r\n      resolve(fact);\r\n    });\r\n  });\r\n};\r\n\r\ngetChuckNorrisFact(url).then(function (fact) {\r\n  return console.log(fact);\r\n} // actually outputs a string\r\n);\r\n*/\r\n\r\n/*\r\nhttps://hackernoon.com/functional-javascript-resolving-promises-sequentially-7aac18c4431e\r\nhttps://medium.freecodecamp.org/how-to-make-a-promise-out-of-a-callback-function-in-javascript-d8ec35d1f981\r\nhttps://decembersoft.com/posts/promises-in-serial-with-array-reduce/\r\nhttps://gist.github.com/anvk/5602ec398e4fdc521e2bf9940fd90f84\r\n*/\r\n","var tooltips = (function() {\r\n  var opciones = {\r\n    trigger: \"custom\",\r\n    delay: 0,\r\n    delayTouch: 0,\r\n    animationDuration: 100,\r\n    triggerOpen: {\r\n      mouseenter: true,\r\n      touchstart: true\r\n    },\r\n    triggerClose: {\r\n      mouseleave: true,\r\n      tap: true\r\n    },\r\n    contentAsHTML: true,\r\n    theme: \"tooltipster-shadow\"\r\n  };\r\n\r\n  function _getOpciones() {\r\n    return opciones;\r\n  }\r\n\r\n  function _debug() {\r\n    opciones.trigger = \"click\";\r\n  }\r\n\r\n  function generaTooltips(elementos) {\r\n    elementos.each(function(d) {\r\n      opciones.content = $(d.tooltip.contenido);\r\n      opciones.theme = \"tooltipster-shadow\";\r\n      $(this).tooltipster(opciones);\r\n    });\r\n  }\r\n\r\n  function actualizaTooltips(elementos) {\r\n    elementos.each(function(d) {\r\n      $(this).tooltipster(\"content\", $(d.tooltip.contenido));\r\n    });\r\n  }\r\n\r\n  return {\r\n    getOpciones: _getOpciones,\r\n    debug: _debug,\r\n    generaTooltips: generaTooltips,\r\n    actualizaTooltips: actualizaTooltips\r\n  };\r\n})();\r\n","var keys =\r\n  keys ||\r\n  function (o) {\r\n    var a = [];\r\n    for (var k in o) a.push(k);\r\n    return a;\r\n  };\r\n\r\nvar slug = function (string) {\r\n  //  var accents = \"àáäâèéëêìíïîòóöôùúüûñç\";\r\n  var accents =\r\n    \"\\u00e0\\u00e1\\u00e4\\u00e2\\u00e8\" +\r\n    \"\\u00e9\\u00eb\\u00ea\\u00ec\\u00ed\\u00ef\" +\r\n    \"\\u00ee\\u00f2\\u00f3\\u00f6\\u00f4\\u00f9\" +\r\n    \"\\u00fa\\u00fc\\u00fb\\u00f1\\u00e7\";\r\n\r\n  var without = \"aaaaeeeeiiiioooouuuunc\";\r\n\r\n  var map = {\r\n    \"@\": \" at \",\r\n    \"\\u20ac\": \" euro \",\r\n    $: \" dollar \",\r\n    \"\\u00a5\": \" yen \",\r\n    \"\\u0026\": \" and \",\r\n    \"\\u00e6\": \"ae\",\r\n    \"\\u0153\": \"oe\",\r\n  };\r\n\r\n  return (\r\n    string\r\n      // Handle uppercase characters\r\n      .toLowerCase()\r\n\r\n      // Handle accentuated characters\r\n      .replace(new RegExp(\"[\" + accents + \"]\", \"g\"), function (c) {\r\n        return without.charAt(accents.indexOf(c));\r\n      })\r\n\r\n      // Handle special characters\r\n      .replace(new RegExp(\"[\" + keys(map).join(\"\") + \"]\", \"g\"), function (c) {\r\n        return map[c];\r\n      })\r\n\r\n      // Dash special characters\r\n      .replace(/[^a-z0-9]/g, \"-\")\r\n\r\n      // Compress multiple dash\r\n      .replace(/-+/g, \"-\")\r\n\r\n      // Trim dashes\r\n      .replace(/^-|-$/g, \"\")\r\n  );\r\n};\r\n","var url = (function() {\r\n  var _sPageURL = window.location.search.substring(1),\r\n    _sURLVariables = _sPageURL.split(\"&\"),\r\n    _sParameterName,\r\n    i;\r\n\r\n  function getParameter(sParam) {\r\n    for (i = 0; i < _sURLVariables.length; i++) {\r\n      _sParameterName = _sURLVariables[i].split(\"=\");\r\n\r\n      if (_sParameterName[0] === sParam) {\r\n        return _sParameterName[1] === undefined\r\n          ? true\r\n          : decodeURIComponent(_sParameterName[1]);\r\n      }\r\n    }\r\n  }\r\n\r\n  return {\r\n    getParameter: getParameter\r\n  };\r\n})();\r\n"]}