<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8" />
  <title></title>
  <!-- TODO add meta tags -->

  <link rel="stylesheet" href="./public/css/pcori.css" />

  <!-- TODO change CSS -->
  <link href="./public/css/nouislider.css" rel="stylesheet" />
  <script src="./public/js/nouislider.js"></script>
</head>

  <body>
    <header><section class="project_header">
  <div class="project_logo">
    <img
      src="./public/img/pcori_logo.svg"
      alt="Patient-Centered Outcomes Research Institute"
    />
  </div>
  <div class="project_title">
    EVIDENCE MAP
    <div class="project_sub">
      SOCIAL NEEDS INTERVENTIONS AND HEALTH OUTCOMES
    </div>
  </div>
</section>
 <div class="col-12">
  <div class="tab_container">
    <div class="tab_spacer">&nbsp;</div>
    <a id="tab_vis" class="tab_item tab_active" href="#"
      >Interactive Visualization</a
    >
    <a id="tab_db" class="tab_item tab_inactive" href="#"
      >Searchable Database</a
    >
    <div class="tab_spacer">&nbsp;</div>
  </div>
</div>
</header>
<main>
  <section id="vis"><section>
  <!-- <strong class="filter_title">Filters: </strong> -->
  <section class="dropdown_grid">
  <div class="vis_dropdown_menu">
    <ul class="nested_dropdown">
      <li>
        <div class="menu_category" id="vis_0_category">Type of social need</div>
        <!-- dropdown categories -->
        <ul class="menu_options" id="vis_0_options">
          <li class="menu_description">
            <p>
              If you select an item below, only the interventions addressing
              that type of social need will remain on the display.
            </p>
          </li>
        </ul>
      </li>
    </ul>
  </div>
  <div class="vis_dropdown_menu">
    <ul class="nested_dropdown">
      <!-- need of population start -->
      <li>
        <div class="menu_category" id="vis_1_category">Target population</div>
        <ul class="menu_options" id="vis_1_options">
          <li class="menu_description">
            <p>
              When you pick an item from this list, only interventions that
              target the selected criterion will remain.
            </p>
          </li>
        </ul>
      </li>
    </ul>
  </div>
  <div class="vis_dropdown_menu">
    <ul class="nested_dropdown">
      <!-- population characteristics start -->
      <li>
        <div class="menu_category" id="vis_2_category">Demographics</div>
        <ul class="menu_options" id="vis_2_options">
          <li class="menu_description">
            <p>
              When you select an item from this list, interventions will be
              sorted in columns.
            </p>
          </li>
        </ul>
      </li>
    </ul>
  </div>
  <div class="vis_dropdown_menu">
    <ul class="nested_dropdown">
      <!-- Outcomes start -->
      <li>
        <div class="menu_category" id="vis_3_category">Type of outcome</div>
        <!-- First level sub dropdown -->
        <ul class="menu_options" id="vis_3_options">
          <li class="menu_description">
            <p>
              When you select an item from this list, only interventions that
              address the selected type of outcome will remain on screen.
              Interventions will be sorted in rows per sub-type of outcome.
            </p>
          </li>
        </ul>
      </li>
    </ul>
  </div>
  <div class="vis_dropdown_menu">
    <ul class="nested_dropdown">
      <li>
        <div class="menu_category" id="vis_4_category">Study quality</div>
        <ul class="menu_options" id="vis_4_options">
          <li class="menu_description">
            <p>
              When you select an item from this list, interventions will be
              color-coded.
            </p>
          </li>
        </ul>
      </li>
    </ul>
  </div>
  <div
    id="vis_0_selection"
    class="dropdown_selection"
    style="visibility: hidden"
  >
    <div class="selection_info">
      You selected:<br />
      <div id="vis_0_reset" class="selection_reset_button">
        <div class="selection_reset_img">
          <img src="./public/img/reset_button_img.svg" alt="" />
        </div>
        <strong id="vis_0_option" class="selection_reset_option">
          Financial Strain
        </strong>
      </div>
    </div>
  </div>
  <div
    id="vis_1_selection"
    class="dropdown_selection"
    style="visibility: hidden"
  >
    <div class="selection_info">
      You selected:<br />
      <div id="vis_1_reset" class="selection_reset_button">
        <div class="selection_reset_img">
          <img src="./public/img/reset_button_img.svg" alt="" />
        </div>
        <strong id="vis_1_option" class="selection_reset_option">
          Financial Strain
        </strong>
      </div>
    </div>
  </div>
  <div
    id="vis_2_selection"
    class="dropdown_selection"
    style="visibility: hidden"
  >
    <div class="selection_info">
      You selected:<br />
      <div id="vis_2_reset" class="selection_reset_button">
        <div class="selection_reset_img">
          <img src="./public/img/reset_button_img.svg" alt="" />
        </div>
        <strong id="vis_2_option" class="selection_reset_option">
          Financial Strain
        </strong>
      </div>
    </div>
  </div>
  <div
    id="vis_3_selection"
    class="dropdown_selection"
    style="visibility: hidden"
  >
    <div class="selection_info">
      You selected:<br />
      <div id="vis_3_reset" class="selection_reset_button">
        <div class="selection_reset_img">
          <img src="./public/img/reset_button_img.svg" alt="" />
        </div>
        <strong id="vis_3_option" class="selection_reset_option">
          Financial Strain
        </strong>
      </div>
    </div>
  </div>
  <div
    id="vis_4_selection"
    class="dropdown_selection"
    style="visibility: hidden"
  >
    <div class="selection_info">
      You selected:<br />
      <div id="vis_4_reset" class="selection_reset_button">
        <div class="selection_reset_img">
          <img src="./public/img/reset_button_img.svg" alt="" />
        </div>
        <strong id="vis_4_option" class="selection_reset_option">
          Financial Strain
        </strong>
      </div>
    </div>
  </div>
</section>

</section>

<section class="vis_text vis_intro">
  <p>
    This evidence map contains information about
    <strong><span class="total_study_count">XX</span> studies</strong>
    on social needs interventions.
  </p>
  <p>
    <strong>
      Each
      <span class="inline_dot">
        <span class="sample_dot"></span>
        &nbsp;<span>dot</span>
      </span>
      represents an intervention. A study may contain multiple interventions.
    </strong>
  </p>
  <p>
    <strong class="menu_signal">You can use these menus</strong> to filter the
    interventions, sort them, and color code them.
  </p>
  <p>
    You can also click on any <strong class="inline_dot">dot</strong> to obtain
    more information about each intervention and its corresponding study.
  </p>
</section>
<section class="visualization_area">
  <div class="color_legend_box">
    <div id="color_legend" class="color_legend hidden">
      <strong id="legend_category">Outcome results</strong>
      <div id="legend_colors"></div>
    </div>
  </div>
  <div class="chart" div id="chart_array"></div>
  <div class="chart hidden" id="chart_row"></div>
  <div class="chart hidden" id="chart_col"></div>
  <div class="chart hidden" id="chart_matrix"></div>
</section>

<section class="vis_text vis_active hidden">
  <p id="vis_criteria_text"></p>
</section>
<section class="export_button_main">
  <div class="export_button_area export_button" id="filter_none">
    <img src="./public/img/export.svg" alt="" />
  </div>
  <div class="export_button_explainer">
    Throughout this application, clicking on this icon will bring up the list of
    studies that fulfill the filters and search criteria you’ve chosen.
  </div>
</section>
</section>
  <section id="db" class="hidden"><section class="db_wrapper">
  <div class="db_filters">
    <div class="title_with_reset">
      <h2 class="db_title">Filters</h2>
      <div class="reset_button hidden">
  <div class="reset_button_img">
    <img src="./public/img/reset_button_img.svg" alt="" />
  </div>
  <div class="reset_button_text">Click here to reset all filters</div>
</div>

    </div>
    <div class="db_content db_filters_content">
      <div class="filter_container">
  <div class="filter_accordion">
    <div class="filter_category" id="accordion_0">
      <div class="filter_title">Target social need</div>
      <div class="filter_toggle">▼</div>
    </div>
    <div class="filter_panel hidden" id="panel_0" id="panel_0">
      <div id="target_social_need"></div>
    </div>
  </div>
  <div class="filter_accordion">
    <div class="filter_category" id="accordion_1">
      <div class="filter_title">Target population</div>

      <div class="filter_toggle">▼</div>
    </div>

    <div class="filter_panel hidden" id="panel_1">
      <div id="target_population"></div>
    </div>
  </div>
  <div class="filter_accordion">
    <div class="filter_category" id="accordion_2">
      <div class="filter_title">Population characteristics</div>

      <div class="filter_toggle">▼</div>
    </div>

    <div class="filter_panel hidden" id="panel_2">
      <div class="filter_sub">
        <h3>Age groups</h3>
        <div id="age_group"></div>
      </div>
      <div class="filter_sub">
        <h3>Majority ethnic/racial group</h3>
        <div id="race_ethnicity_majority"></div>
      </div>
      <div class="filter_sub">
        <h3>
          Percentage Male
          <span class="small_direction"> (select a range of values)</span>
        </h3>
        <!-- TODO alert when clicking slider -->
        <div class="filter_item slider" id="slider_male"></div>
      </div>
      <div class="filter_sub">
        <h3>
          Proportion of Immigrants
          <span class="small_direction"> (select a range of values)</span>
        </h3>
        <div class="filter_item slider" id="slider_immigrant"></div>
      </div>
    </div>
  </div>
  <div class="filter_accordion">
    <div class="filter_category" id="accordion_3">
      <div class="filter_title">Intervention target</div>
      <div class="filter_toggle">▼</div>
    </div>

    <div class="filter_panel hidden" id="panel_3">
      <div id="intervention_target"></div>
    </div>
    <div class="filter_accordion">
      <div class="filter_category" id="accordion_4">
        <div class="filter_title">Intervention setting</div>

        <div class="filter_toggle">▼</div>
      </div>

      <div class="filter_panel hidden" id="panel_4">
        <div id="intervention_setting"></div>
      </div>
    </div>
    <div class="filter_accordion">
      <div class="filter_category" id="accordion_5">
        <div class="filter_title">Specific intervention components</div>

        <div class="filter_toggle">▼</div>
      </div>

      <div class="filter_panel hidden" id="panel_5">
        <div id="specific_intervention_components"></div>
      </div>
      <div class="filter_accordion">
        <div class="filter_category" id="accordion_6">
          <div class="filter_title">Recruitment setting</div>

          <div class="filter_toggle">▼</div>
        </div>

        <div class="filter_panel hidden" id="panel_6">
          <div id="recruitment_setting"></div>
        </div>
        <div class="filter_accordion">
          <div class="filter_category" id="accordion_7">
            <div class="filter_title">
              Characteristics and quality of the study
            </div>

            <div class="filter_toggle">▼</div>
          </div>

          <div class="filter_panel hidden" id="panel_7">
            <div class="filter_sub">
              <h3>Study Design</h3>
              <div id="study_design"></div>
            </div>
            <div class="filter_sub">
              <h3>Risk of bias</h3>
              <div id="risk_of_bias"></div>
            </div>
            <div class="filter_sub">
              <h3>
                Sample size
                <span class="small_direction"> (select a range of values)</span>
              </h3>
              <div class="filter_item slider" id="slider_sample"></div>
            </div>
            <div class="filter_sub">
              <h3>Individual vs. Systems intervention</h3>
              <div id="individual_systems_intervention"></div>
            </div>
          </div>
        </div>
        <div class="filter_accordion">
          <div class="filter_category" id="accordion_8">
            <div class="filter_title">Study type by target domain</div>

            <div class="filter_toggle">▼</div>
          </div>

          <div class="filter_panel hidden" id="panel_8">
            <div id="study_type"></div>
          </div>
          <div class="filter_accordion">
            <div class="filter_category" id="accordion_9">
              <div class="filter_title">Service provider</div>

              <div class="filter_toggle">▼</div>
            </div>

            <div class="filter_panel hidden" id="panel_9">
              <div id="service_provider"></div>
            </div>
            <div class="filter_accordion">
              <div class="filter_category" id="accordion_10">
                <div class="filter_title">Type of comparator</div>

                <div class="filter_toggle">▼</div>
              </div>
              <div class="filter_panel hidden" id="panel_10">
                <div id="comparator"></div>
              </div>
              <div class="filter_accordion">
                <div class="filter_category" id="accordion_11">
                  <div class="filter_title">Behavioral outcomes</div>
                  <div class="filter_toggle">▼</div>
                </div>
                <div class="filter_panel hidden" id="panel_11">
                  <div id="behavioral_outcomes"></div>
                </div>
                <div class="filter_accordion">
                  <div class="filter_category" id="accordion_12">
                    <div class="filter_title">Health outcomes</div>

                    <div class="filter_toggle">▼</div>
                  </div>

                  <div class="filter_panel hidden" id="panel_12">
                    <div id="health_outcomes"></div>
                  </div>
                  <div class="filter_accordion">
                    <div class="filter_category" id="accordion_13">
                      <div class="filter_title">
                        Healthcare utilization outcomes
                      </div>

                      <div class="filter_toggle">▼</div>
                    </div>

                    <div class="filter_panel hidden" id="panel_13">
                      <div id="healthcareuse_outcomes"></div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

    </div>
  </div>
  <div class="db_results">
    <h2 class="db_title">Filtered list of studies</h2>
    <div class="db_content db_results_content">
      <div class="results_container">
  <section id="results_intro">
    <div class="results_intro_text">
      <p>
        This searchable database contains information about
        <strong><span class="total_study_count">XX</span> studies</strong>.
      </p>
      <p>
        To begin showing studies in this window, select items from the menus on
        the left.
      </p>
    </div>
  </section>
  <section class="search_results hidden">
    <p id="result_summary">
      Showing the
      <strong id="result_count"
        ><span id="relevant_study_count">XX</span> studies</strong
      >
      (out of <strong class="total_study_count">XX</strong>) that fulfill the
      criteria you selected.
    </p>
    <div class="combination_results"></div>
  </section>
</div>

    </div>
  </div>
</section>
</section>
  <div id="study_modal" class="modal">
  <!-- Modal content -->
  <!-- TODO make header & filters sticky on the top -->
  <div class="modal-content">
    <div class="modal_header">
      <div class="modal_header_img">
        <img src="./public/img/reset_button_img.svg" alt="" />
      </div>
      <div class="modal_header_text">
        List of studies fulfilling the filters you have selected:
      </div>
    </div>
    <div class="modal_list hidden">
      <div class="modal_filters"></div>
      <div class="modal_studies"></div>
    </div>
    <div class="modal_single hidden">
      <div class="single_study_info"></div>
      <div class="study_tba">
        <em>
          More information about the study will be available in the future.
        </em>
      </div>
    </div>
  </div>
</div>

</main>

<script src="./public/js/lodash.js"></script>
<script src="./public/js/d3.v5.min.js"></script>
<script src="./public/js/tab_manager.js"></script>
<script>
  // populate total_study_count areas
  // TODO group this into an input manager
  async function totalStudyCount() {
    let dataset = await d3.csv('./public/data/pcori_1124.csv');
    // TODO uncomment this if we use interventions
    const ref_id = d => d.ref_id;
    const studies = d3.map(dataset, ref_id).keys();
    const unique_studies = new Set(studies);
    d3.selectAll('.total_study_count').html(`${unique_studies.size}`);
  }
  totalStudyCount();
</script>
<!-- <script src="./public/js/accordions.js"></script> -->
<script src="./public/js/accessors.js"></script>
<script src="./public/js/helper_functions.js"></script>
<!-- TODO tweak slider for sample_size to use max-->
<script src="./public/js/visualization_manager.js"></script>
<script src="./public/js/database_manager.js"></script>
<script src="./public/js/reset_tool.js"></script>



  </body>
</html>
